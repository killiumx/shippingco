<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>IslandShip â€” Admin Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
/* â•â•â• TOKENS â•â•â• */
:root{
  --navy:#0a1628;--navy2:#0d1f3c;--navy3:#132952;
  --blue:#1a56db;--blue2:#1e40af;--blue-lt:#3b82f6;
  --sky:#0ea5e9;--ice:#e0f2fe;
  --white:#fff;--off:#f8faff;--mist:#f0f6ff;
  --silver:#cbd5e1;--slate:#64748b;--mid:#334155;
  --gold:#f59e0b;--warn:#f97316;
  --ok:#10b981;--err:#ef4444;
  --fh:'Syne',sans-serif;--fb:'DM Sans',sans-serif;
  --rsm:8px;--rmd:14px;--rlg:22px;--rxl:32px;
  --s1:0 2px 8px rgba(26,86,219,.08);
  --s2:0 8px 32px rgba(26,86,219,.12);
  --s3:0 24px 64px rgba(10,22,40,.18);
  --tr:all .26s cubic-bezier(.23,1,.32,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px;scroll-behavior:smooth}
body{font-family:var(--fb);background:var(--off);color:var(--navy);overflow-x:hidden}
input,select,textarea,button{font-family:var(--fb)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:var(--blue-lt);border-radius:3px}

/* â•â•â• ANIMATIONS â•â•â• */
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(26,86,219,.4)}50%{box-shadow:0 0 0 10px rgba(26,86,219,0)}}
@keyframes shimmer{0%{background-position:-200% center}100%{background-position:200% center}}
@keyframes countUp{from{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-16px)}to{opacity:1;transform:translateX(0)}}
@keyframes toastIn{from{opacity:0;transform:translateX(120%)}to{opacity:1;transform:translateX(0)}}
@keyframes waveFlow{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes shipSail{0%{transform:translateX(-160px);opacity:0}5%{opacity:1}95%{opacity:1}100%{transform:translateX(110vw);opacity:0}}
@keyframes planeFly{0%{transform:translateX(-120px) translateY(6px) rotate(-3deg);opacity:0}6%{opacity:1}95%{opacity:1}100%{transform:translateX(110vw) translateY(-18px) rotate(1deg);opacity:0}}
@keyframes bubUp{0%{transform:translateY(0) scale(1);opacity:.4}100%{transform:translateY(-80vh) scale(.2);opacity:0}}
@keyframes progressW{from{width:0}to{width:var(--w,0%)}}
@keyframes barGrow{from{height:0}to{height:var(--h,0%)}}

/* â•â•â• SCENE â•â•â• */
#scene{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.sc-bg{position:absolute;inset:0;background:linear-gradient(170deg,#e8f4ff 0%,#f8faff 55%,#eef6ff 100%)}
.sc-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(26,86,219,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(26,86,219,.025) 1px,transparent 1px);background-size:65px 65px}
.blob{position:absolute;border-radius:50%;filter:blur(90px)}
.sc-ocean{position:absolute;bottom:0;left:0;right:0;height:120px;overflow:hidden}
.wt{position:absolute;bottom:0;width:200%}
.wt1{animation:waveFlow 12s linear infinite}
.wt2{animation:waveFlow 19s linear infinite reverse;bottom:8px;opacity:.55}
.sc-ship{position:absolute;bottom:8%;animation:shipSail 54s 6s linear infinite}
.sc-ship2{position:absolute;bottom:3%;animation:shipSail 78s 38s linear infinite;opacity:.5}
.sc-plane{position:absolute;top:5%;animation:planeFly 28s 2s linear infinite}
.sc-plane2{position:absolute;top:2%;animation:planeFly 48s 24s linear infinite;opacity:.45}
.bub{position:absolute;bottom:0;border-radius:50%;background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.2);animation:bubUp var(--d) var(--dl) infinite ease-in}

/* â•â•â• LAYOUT â•â•â• */
#app{position:relative;z-index:1;display:flex;min-height:100vh}

/* â•â•â• SIDEBAR â•â•â• */
.sidebar{
  position:fixed;top:0;left:0;bottom:0;width:256px;
  background:var(--navy);z-index:200;display:flex;flex-direction:column;
  box-shadow:4px 0 28px rgba(10,22,40,.2);
}
.sb-logo{padding:24px 20px 18px;display:flex;align-items:center;gap:11px;border-bottom:1px solid rgba(255,255,255,.07)}
.sb-logo-icon{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--blue),var(--sky));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 14px rgba(26,86,219,.4);flex-shrink:0}
.sb-logo-text{font-family:var(--fh);font-size:19px;font-weight:800;color:#fff}
.sb-logo-text span{background:linear-gradient(135deg,var(--sky),#38bdf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sb-admin-badge{margin:10px 14px;background:linear-gradient(135deg,rgba(26,86,219,.35),rgba(14,165,233,.2));border:1px solid rgba(26,86,219,.35);border-radius:var(--rsm);padding:10px 14px;display:flex;align-items:center;gap:10px}
.sb-admin-avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--warn));display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#fff;flex-shrink:0}
.sb-admin-name{font-size:13px;font-weight:700;color:#fff}
.sb-admin-role{font-size:10px;color:var(--gold);font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-top:2px}
.sb-nav{flex:1;padding:6px 10px;overflow-y:auto}
.sb-group{font-size:9px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:rgba(255,255,255,.25);padding:12px 10px 5px}
.ni{display:flex;align-items:center;gap:11px;padding:10px 12px;border-radius:var(--rsm);cursor:pointer;margin-bottom:2px;font-size:13px;font-weight:500;color:rgba(255,255,255,.52);transition:var(--tr);position:relative}
.ni:hover{color:#fff;background:rgba(255,255,255,.07)}
.ni.active{color:#fff;background:linear-gradient(135deg,rgba(26,86,219,.4),rgba(14,165,233,.22));border:1px solid rgba(26,86,219,.35)}
.ni.active::before{content:'';position:absolute;left:0;top:22%;bottom:22%;width:3px;border-radius:0 3px 3px 0;background:linear-gradient(180deg,var(--blue),var(--sky))}
.ni-icon{font-size:16px;width:20px;text-align:center;flex-shrink:0}
.ni-badge{margin-left:auto;background:var(--err);color:#fff;font-size:9px;font-weight:700;min-width:17px;height:17px;border-radius:9px;display:flex;align-items:center;justify-content:center;padding:0 4px}
.sb-foot{padding:12px 10px;border-top:1px solid rgba(255,255,255,.07)}
.sb-foot .ni{color:rgba(255,255,255,.36)}
.sb-foot .ni:hover{color:var(--err);background:rgba(239,68,68,.07)}

/* â•â•â• MAIN â•â•â• */
.main{margin-left:256px;min-height:100vh;display:flex;flex-direction:column;width:calc(100% - 256px)}
.topbar{height:66px;background:rgba(248,250,255,.93);backdrop-filter:blur(20px);border-bottom:1px solid rgba(26,86,219,.08);display:flex;align-items:center;justify-content:space-between;padding:0 32px;position:sticky;top:0;z-index:100;box-shadow:0 2px 14px rgba(10,22,40,.05)}
.tb-title{font-family:var(--fh);font-size:19px;font-weight:700;color:var(--navy)}
.tb-right{display:flex;align-items:center;gap:11px}
.notif-btn{width:36px;height:36px;border-radius:var(--rsm);background:rgba(26,86,219,.07);border:1px solid rgba(26,86,219,.1);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:17px;position:relative;transition:var(--tr)}
.notif-btn:hover{background:rgba(26,86,219,.13)}
.notif-dot{position:absolute;top:5px;right:5px;width:7px;height:7px;border-radius:50%;background:var(--err);border:2px solid var(--off)}
.pc{flex:1;padding:28px 30px;max-width:1300px}

/* â•â•â• TAB BAR â•â•â• */
.tab-bar{display:flex;gap:3px;background:rgba(255,255,255,.82);border:1px solid rgba(26,86,219,.1);border-radius:var(--rmd);padding:4px;margin-bottom:24px;flex-wrap:wrap;box-shadow:var(--s1);backdrop-filter:blur(10px)}
.tab{padding:8px 16px;border-radius:var(--rsm);font-size:12px;font-weight:600;cursor:pointer;color:var(--slate);transition:var(--tr);display:flex;align-items:center;gap:5px;white-space:nowrap}
.tab:hover{color:var(--blue);background:rgba(26,86,219,.06)}
.tab.active{background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;box-shadow:0 4px 12px rgba(26,86,219,.28)}

/* â•â•â• CARDS â•â•â• */
.card{background:rgba(255,255,255,.92);backdrop-filter:blur(16px);border:1px solid rgba(26,86,219,.08);border-radius:var(--rlg);padding:24px;box-shadow:var(--s1);transition:var(--tr)}
.card:hover{box-shadow:var(--s2)}
.card-3d{transform-style:preserve-3d}
.card-3d:hover{transform:perspective(1000px) rotateX(-2deg) rotateY(2.5deg) translateZ(6px)}

/* â•â•â• STAT CARDS â•â•â• */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:14px;margin-bottom:24px}
.sc{background:#fff;border-radius:var(--rlg);padding:20px 18px;border:1px solid rgba(26,86,219,.08);box-shadow:var(--s1);position:relative;overflow:hidden;transition:var(--tr);animation:fadeUp .5s var(--d,0s) ease both}
.sc:hover{transform:translateY(-4px);box-shadow:var(--s2)}
.sc::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--bar,linear-gradient(90deg,var(--blue),var(--sky)))}
.sc-ic{font-size:26px;margin-bottom:10px}
.sc-val{font-family:var(--fh);font-size:30px;font-weight:800;background:var(--gr,linear-gradient(135deg,var(--blue),var(--sky)));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;animation:countUp .5s ease both}
.sc-lbl{font-size:11px;color:var(--slate);font-weight:500;margin-top:4px}

/* â•â•â• BUTTONS â•â•â• */
.btn{border:none;border-radius:var(--rmd);font-weight:600;cursor:pointer;transition:var(--tr);display:inline-flex;align-items:center;justify-content:center;gap:7px}
.btn:hover{transform:translateY(-2px) scale(1.015)}
.btn:active{transform:translateY(0) scale(.98)}
.btn-p{background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;padding:10px 22px;font-size:14px;box-shadow:0 4px 16px rgba(26,86,219,.32)}
.btn-p:hover{box-shadow:0 8px 26px rgba(26,86,219,.44)}
.btn-o{background:transparent;color:var(--blue);border:1.5px solid rgba(26,86,219,.28);padding:9px 20px;font-size:14px}
.btn-o:hover{border-color:var(--blue);background:rgba(26,86,219,.04)}
.btn-g{background:rgba(26,86,219,.07);color:var(--blue);padding:9px 18px;font-size:14px}
.btn-danger{background:linear-gradient(135deg,var(--err),#dc2626);color:#fff;padding:9px 18px;font-size:14px}
.btn-ok{background:linear-gradient(135deg,var(--ok),#059669);color:#fff;padding:9px 18px;font-size:14px}
.btn-warn{background:linear-gradient(135deg,var(--gold),var(--warn));color:#fff;padding:9px 18px;font-size:14px}
.btn-sm{padding:6px 13px;font-size:12px}
.btn-lg{padding:13px 30px;font-size:15px}
.btn-fw{width:100%}
.btn-dis{opacity:.45;cursor:not-allowed;pointer-events:none}

/* â•â•â• TABLE â•â•â• */
.tw{overflow-x:auto;border-radius:var(--rmd)}
table{width:100%;border-collapse:collapse;font-size:13px}
thead th{text-align:left;padding:9px 13px;font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--slate);background:var(--mist);border-bottom:2px solid rgba(26,86,219,.1);white-space:nowrap}
tbody tr{border-bottom:1px solid rgba(26,86,219,.05);transition:var(--tr)}
tbody tr:hover{background:rgba(26,86,219,.022)}
tbody td{padding:13px 13px;color:var(--mid);vertical-align:middle}
.tid{color:var(--blue);font-weight:700;font-size:11px;font-family:var(--fh);white-space:nowrap}
.tlink{color:var(--sky);cursor:pointer;font-weight:600;font-size:12px}
.tlink:hover{text-decoration:underline}

/* â•â•â• BADGE â•â•â• */
.badge{display:inline-flex;align-items:center;gap:4px;border-radius:40px;padding:3px 10px;font-size:10px;font-weight:700;white-space:nowrap}
.b-wh{background:rgba(245,158,11,.1);color:#b45309;border:1px solid rgba(245,158,11,.25)}
.b-tr{background:rgba(14,165,233,.1);color:#0369a1;border:1px solid rgba(14,165,233,.25)}
.b-cu{background:rgba(249,115,22,.1);color:#c2410c;border:1px solid rgba(249,115,22,.25)}
.b-rd{background:rgba(16,185,129,.1);color:#065f46;border:1px solid rgba(16,185,129,.25)}
.b-dl{background:rgba(100,116,139,.1);color:var(--slate);border:1px solid rgba(100,116,139,.2)}
.b-paid{background:rgba(16,185,129,.1);color:#065f46;border:1px solid rgba(16,185,129,.25)}
.b-un{background:rgba(239,68,68,.08);color:#b91c1c;border:1px solid rgba(239,68,68,.2)}
.b-pend{background:rgba(245,158,11,.08);color:#b45309;border:1px solid rgba(245,158,11,.2)}
.b-admin{background:rgba(139,92,246,.1);color:#6d28d9;border:1px solid rgba(139,92,246,.2)}
.b-cust{background:rgba(26,86,219,.07);color:var(--blue);border:1px solid rgba(26,86,219,.15)}

/* â•â•â• FORM â•â•â• */
.field{margin-bottom:16px}
.field label{display:block;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--slate);margin-bottom:6px}
.field input,.field select,.field textarea{width:100%;padding:11px 15px;border-radius:var(--rsm);border:1.5px solid #e2e8f0;background:#f8faff;color:var(--navy);font-size:13px;font-family:var(--fb);outline:none;transition:var(--tr)}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--blue);background:#fff;box-shadow:0 0 0 4px rgba(26,86,219,.08)}
.fr2{display:grid;grid-template-columns:1fr 1fr;gap:13px}
.fr3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:13px}

/* â•â•â• MODAL â•â•â• */
.mo{position:fixed;inset:0;z-index:900;background:rgba(10,22,40,.55);backdrop-filter:blur(14px);display:flex;align-items:center;justify-content:center;padding:18px;opacity:0;pointer-events:none;transition:opacity .26s ease}
.mo.open{opacity:1;pointer-events:all}
.md{background:#fff;border-radius:var(--rxl);width:100%;max-width:640px;max-height:92vh;overflow-y:auto;box-shadow:0 40px 100px rgba(10,22,40,.2);transform:translateY(18px) scale(.97);transition:transform .3s cubic-bezier(.23,1,.32,1)}
.mo.open .md{transform:translateY(0) scale(1)}
.md-lg{max-width:820px}
.md-head{background:linear-gradient(135deg,var(--navy),var(--navy2));padding:24px 28px;border-radius:var(--rxl) var(--rxl) 0 0;position:relative;overflow:hidden}
.md-head::before{content:'';position:absolute;top:-50px;right:-50px;width:170px;height:170px;border-radius:50%;background:radial-gradient(circle,rgba(26,86,219,.22),transparent)}
.md-head h3{font-family:var(--fh);font-size:20px;font-weight:700;color:#fff;position:relative;z-index:1}
.md-head p{font-size:12px;color:rgba(255,255,255,.48);margin-top:4px;position:relative;z-index:1}
.md-close{position:absolute;top:14px;right:14px;width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,.1);color:#fff;font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;z-index:2;transition:var(--tr)}
.md-close:hover{background:rgba(255,255,255,.18)}
.md-body{padding:24px 28px}

/* â•â•â• ALERT â•â•â• */
.alert{border-radius:var(--rmd);padding:11px 15px;font-size:13px;margin-bottom:15px;display:flex;align-items:flex-start;gap:8px}
.a-warn{background:rgba(249,115,22,.07);border:1px solid rgba(249,115,22,.2);color:#c2410c}
.a-info{background:rgba(26,86,219,.06);border:1px solid rgba(26,86,219,.16);color:var(--blue2)}
.a-ok{background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.2);color:#065f46}
.a-err{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.18);color:#b91c1c}

/* â•â•â• TOAST â•â•â• */
#toast-ct{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:9px}
.toast{display:flex;align-items:center;gap:11px;background:#fff;border-radius:var(--rmd);padding:12px 16px;box-shadow:0 8px 30px rgba(10,22,40,.15);border-left:4px solid var(--blue);min-width:260px;max-width:350px;animation:toastIn .33s cubic-bezier(.23,1,.32,1) both;font-size:13px;color:var(--navy)}
.toast.ok{border-color:var(--ok)}.toast.err{border-color:var(--err)}.toast.warn{border-color:var(--gold)}

/* â•â•â• MISC â•â•â• */
.hidden{display:none!important}
.spinner{width:16px;height:16px;border-radius:50%;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;animation:spin .75s linear infinite;flex-shrink:0}
.sp-blue{border:2px solid rgba(26,86,219,.2);border-top-color:var(--blue)}
.sh{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;flex-wrap:wrap;gap:10px}
.st{font-family:var(--fh);font-size:18px;font-weight:700;color:var(--navy)}
.dh{height:1px;background:rgba(26,86,219,.08);margin:18px 0}
.chip{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:600;background:rgba(26,86,219,.08);color:var(--blue);border:1px solid rgba(26,86,219,.14)}
.search-bar{display:flex;gap:10px;margin-bottom:18px;flex-wrap:wrap}
.search-inp{flex:1;min-width:180px;padding:9px 14px;border-radius:var(--rsm);border:1.5px solid #e2e8f0;background:#f8faff;color:var(--navy);font-size:13px;outline:none;transition:var(--tr)}
.search-inp:focus{border-color:var(--blue);background:#fff;box-shadow:0 0 0 3px rgba(26,86,219,.08)}
.sel{padding:9px 14px;border-radius:var(--rsm);border:1.5px solid #e2e8f0;background:#f8faff;color:var(--navy);font-size:13px;outline:none;cursor:pointer}
.sel:focus{border-color:var(--blue)}

/* â•â•â• ANNOUNCEMENT â•â•â• */
.ann-card{border-radius:var(--rlg);padding:20px;border:1px solid;margin-bottom:12px;position:relative;overflow:hidden;transition:var(--tr)}
.ann-card:hover{transform:translateY(-2px);box-shadow:var(--s2)}
.ann-card.info{background:rgba(26,86,219,.04);border-color:rgba(26,86,219,.18)}
.ann-card.warn{background:rgba(245,158,11,.04);border-color:rgba(245,158,11,.22)}
.ann-card.success{background:rgba(16,185,129,.04);border-color:rgba(16,185,129,.22)}
.ann-card.danger{background:rgba(239,68,68,.04);border-color:rgba(239,68,68,.2)}
.ann-type-badge{display:inline-flex;align-items:center;gap:5px;border-radius:20px;padding:3px 10px;font-size:10px;font-weight:700;margin-bottom:10px}

/* â•â•â• PROGRESS BAR â•â•â• */
.prog-track{height:7px;background:#e2e8f0;border-radius:4px;overflow:hidden}
.prog-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--blue),var(--sky));width:var(--w,0%);animation:progressW .8s .2s ease both}

/* â•â•â• CHART BAR â•â•â• */
.chart-bars{display:flex;align-items:flex-end;gap:6px;height:110px;padding-top:10px}
.bar-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px}
.bar{width:100%;border-radius:4px 4px 0 0;background:linear-gradient(180deg,var(--blue),var(--sky));height:var(--h,20px);animation:barGrow .7s ease both;min-height:4px}
.bar-lbl{font-size:9px;color:var(--slate);font-weight:600;white-space:nowrap}
.bar-val{font-size:10px;color:var(--blue);font-weight:700}

/* â•â•â• RESPONSIVE â•â•â• */
@media(max-width:900px){.sidebar{width:220px}.main{margin-left:220px;width:calc(100% - 220px)}.pc{padding:20px}}
@media(max-width:660px){.sidebar{transform:translateX(-100%);width:256px;transition:var(--tr)}.sidebar.open{transform:translateX(0)}.main{margin-left:0;width:100%}.pc{padding:16px}.fr2,.fr3{grid-template-columns:1fr}}
</style>
</head>
<body>

<!-- â•â•â• SCENE â•â•â• -->
<div id="scene">
  <div class="sc-bg"></div>
  <div class="sc-grid"></div>
  <div class="blob" style="width:480px;height:480px;background:radial-gradient(circle,rgba(26,86,219,.1),transparent);top:-80px;right:-40px;opacity:.3"></div>
  <div class="blob" style="width:320px;height:320px;background:radial-gradient(circle,rgba(14,165,233,.09),transparent);bottom:60px;left:-70px;opacity:.28"></div>

  <div class="sc-plane">
    <svg width="85" height="40" viewBox="0 0 220 104" fill="none">
      <defs><linearGradient id="pf" x1="0" y1=".5" x2="1" y2=".5"><stop stop-color="#1a56db"/><stop offset="1" stop-color="#0ea5e9"/></linearGradient></defs>
      <path d="M18 50 Q42 42 105 47 Q158 47 195 52 Q205 52 205 56 Q205 60 195 61 Q158 66 105 61 Q42 66 18 58Z" fill="url(#pf)"/>
      <path d="M195 52 L212 56 L195 61Z" fill="#e0f2fe"/>
      <path d="M72 48 L92 14 L150 47Z" fill="#1e40af"/>
      <path d="M72 60 L92 94 L150 61Z" fill="#1e40af" opacity=".8"/>
    </svg>
  </div>
  <div class="sc-plane2">
    <svg width="54" height="26" viewBox="0 0 220 104" fill="none">
      <path d="M18 50 Q42 42 105 47 Q158 47 195 52 Q205 52 205 56 Q205 60 195 61 Q158 66 105 61 Q42 66 18 58Z" fill="#1a56db"/>
      <path d="M72 48 L92 14 L150 47Z" fill="#1e40af"/>
    </svg>
  </div>
  <div class="sc-ship">
    <svg width="115" height="74" viewBox="0 0 240 155" fill="none" style="filter:drop-shadow(0 5px 14px rgba(26,86,219,.22))">
      <defs><linearGradient id="sh" x1="0" y1="0" x2="0" y2="1"><stop stop-color="#1a56db"/><stop offset="1" stop-color="#1e3a8a"/></linearGradient></defs>
      <path d="M30 98 L210 98 L192 128 L48 128Z" fill="url(#sh)"/>
      <path d="M30 98 L42 80 L198 80 L210 98Z" fill="#1e40af"/>
      <rect x="72" y="50" width="96" height="32" rx="6" fill="#dbeafe"/>
      <rect x="88" y="34" width="64" height="18" rx="4" fill="#dbeafe"/>
      <rect x="108" y="8" width="8" height="28" rx="2" fill="#1a56db"/>
      <path d="M108 8 L122 13 L108 18Z" fill="#3b82f6"/>
    </svg>
  </div>
  <div class="sc-ship2">
    <svg width="68" height="44" viewBox="0 0 240 155" fill="none">
      <path d="M30 98 L210 98 L192 128 L48 128Z" fill="#1e3a8a"/>
      <path d="M30 98 L42 80 L198 80 L210 98Z" fill="#1e40af"/>
      <rect x="72" y="50" width="96" height="32" rx="6" fill="#bfdbfe"/>
    </svg>
  </div>
  <div class="sc-ocean">
    <div class="wt wt1"><svg width="200%" height="80" viewBox="0 0 2880 80" preserveAspectRatio="none" style="display:block"><path d="M0,40 C180,7 360,73 540,40 C720,7 900,73 1080,40 C1260,7 1440,73 1440,40 C1620,7 1800,73 1980,40 C2160,7 2340,73 2520,40 C2700,7 2880,73 2880,40 L2880,80 L0,80Z" fill="rgba(26,86,219,.055)"/></svg></div>
    <div class="wt wt2"><svg width="200%" height="60" viewBox="0 0 2880 60" preserveAspectRatio="none" style="display:block"><path d="M0,30 C240,3 480,57 720,30 C960,3 1200,57 1440,30 C1680,3 1920,57 2160,30 C2400,3 2640,57 2880,30 L2880,60 L0,60Z" fill="rgba(14,165,233,.035)"/></svg></div>
  </div>
  <div id="bubs"></div>
</div>

<div id="toast-ct"></div>

<!-- â•â•â• APP â•â•â• -->
<div id="app">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-logo">
      <div class="sb-logo-icon">ğŸ‡¯ğŸ‡²</div>
      <div class="sb-logo-text">Island<span>Ship</span></div>
    </div>
    <div class="sb-admin-badge">
      <div class="sb-admin-avatar" id="adminAvatar">A</div>
      <div>
        <div class="sb-admin-name" id="adminName">Admin User</div>
        <div class="sb-admin-role">âš¡ Administrator</div>
      </div>
    </div>
    <nav class="sb-nav">
      <div class="sb-group">Overview</div>
      <div class="ni active" onclick="goTab('overview')"><span class="ni-icon">ğŸ“Š</span>Dashboard</div>
      <div class="ni" onclick="goTab('analytics')"><span class="ni-icon">ğŸ“ˆ</span>Analytics</div>

      <div class="sb-group">Management</div>
      <div class="ni" onclick="goTab('packages')"><span class="ni-icon">ğŸ“¦</span>Packages<span class="ni-badge" id="nb-packages">0</span></div>
      <div class="ni" onclick="goTab('customers')"><span class="ni-icon">ğŸ‘¥</span>Customers</div>
      <div class="ni" onclick="goTab('prealerts')"><span class="ni-icon">ğŸ“¬</span>Pre-Alerts<span class="ni-badge" id="nb-prealerts" style="display:none">0</span></div>
      <div class="ni" onclick="goTab('transactions')"><span class="ni-icon">ğŸ’³</span>Transactions</div>

      <div class="sb-group">Content</div>
      <div class="ni" onclick="goTab('announcements')"><span class="ni-icon">ğŸ“¢</span>Announcements</div>
      <div class="ni" onclick="goTab('rates')"><span class="ni-icon">ğŸ’°</span>Rates & Fees</div>
      <div class="ni" onclick="goTab('branches')"><span class="ni-icon">ğŸ“</span>Branches</div>

      <div class="sb-group">System</div>
      <div class="ni" onclick="goTab('settings')"><span class="ni-icon">âš™ï¸</span>Settings</div>
    </nav>
    <div class="sb-foot">
      <div class="ni" onclick="goCustomerDash()"><span class="ni-icon">ğŸ‘¤</span>Customer View</div>
      <div class="ni" onclick="goHome()"><span class="ni-icon">ğŸŒ</span>View Website</div>
      <div class="ni" onclick="doSignOut()"><span class="ni-icon">ğŸšª</span>Sign Out</div>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div class="tb-title" id="tbTitle">Dashboard Overview</div>
      <div class="tb-right">
        <div class="notif-btn" onclick="showToast('info','ğŸ“­ No new system alerts')">ğŸ””<div class="notif-dot"></div></div>
        <button class="btn btn-p btn-sm" onclick="openMod('add-pkg-modal')">+ Add Package</button>
        <button class="btn btn-warn btn-sm" onclick="openMod('ann-modal')">ğŸ“¢ Announce</button>
      </div>
    </div>

    <div class="pc">

      <!-- â•â• OVERVIEW â•â• -->
      <div id="t-overview">
        <div class="stats">
          <div class="sc" style="--d:.00s"><div class="sc-ic">ğŸ“¦</div><div class="sc-val" id="sv-total">0</div><div class="sc-lbl">Total Packages</div></div>
          <div class="sc" style="--d:.05s;--gr:linear-gradient(135deg,#f59e0b,#d97706);--bar:linear-gradient(90deg,#f59e0b,#d97706)"><div class="sc-ic">ğŸ­</div><div class="sc-val" id="sv-wh">0</div><div class="sc-lbl">In Warehouse</div></div>
          <div class="sc" style="--d:.10s;--gr:linear-gradient(135deg,#0ea5e9,#38bdf8);--bar:linear-gradient(90deg,#0ea5e9,#38bdf8)"><div class="sc-ic">âœˆï¸</div><div class="sc-val" id="sv-tr">0</div><div class="sc-lbl">In Transit</div></div>
          <div class="sc" style="--d:.15s;--gr:linear-gradient(135deg,#f97316,#ea580c);--bar:linear-gradient(90deg,#f97316,#ea580c)"><div class="sc-ic">ğŸ›ƒ</div><div class="sc-val" id="sv-cu">0</div><div class="sc-lbl">At Customs</div></div>
          <div class="sc" style="--d:.20s;--gr:linear-gradient(135deg,#10b981,#059669);--bar:linear-gradient(90deg,#10b981,#059669)"><div class="sc-ic">âœ…</div><div class="sc-val" id="sv-dl">0</div><div class="sc-lbl">Delivered</div></div>
          <div class="sc" style="--d:.25s;--gr:linear-gradient(135deg,#ef4444,#dc2626);--bar:linear-gradient(90deg,#ef4444,#dc2626)"><div class="sc-ic">ğŸ’³</div><div class="sc-val" id="sv-up">0</div><div class="sc-lbl">Unpaid</div></div>
          <div class="sc" style="--d:.30s"><div class="sc-ic">ğŸ’°</div><div class="sc-val" id="sv-rev">$0</div><div class="sc-lbl">Revenue Collected</div></div>
          <div class="sc" style="--d:.35s;--gr:linear-gradient(135deg,#8b5cf6,#6d28d9);--bar:linear-gradient(90deg,#8b5cf6,#6d28d9)"><div class="sc-ic">ğŸ‘¥</div><div class="sc-val" id="sv-cust">0</div><div class="sc-lbl">Customers</div></div>
        </div>

        <div style="display:grid;grid-template-columns:1.5fr 1fr;gap:20px;margin-bottom:20px">
          <!-- Recent packages -->
          <div class="card">
            <div class="sh"><div class="st">Recent Packages</div><button class="btn btn-g btn-sm" onclick="goTab('packages')">View All â†’</button></div>
            <div class="tw"><table>
              <thead><tr><th>ID</th><th>Customer</th><th>Description</th><th>Status</th><th>Cost</th><th>Action</th></tr></thead>
              <tbody id="ov-pkgs"></tbody>
            </table></div>
          </div>

          <!-- Quick stats / chart -->
          <div class="card">
            <div class="sh"><div class="st">Status Breakdown</div></div>
            <div class="chart-bars" id="status-chart"></div>
            <div class="dh"></div>
            <div style="font-size:12px;color:var(--slate);line-height:2.2">
              <div style="display:flex;justify-content:space-between"><span>ğŸ“¬ Pending Pre-Alerts</span><strong id="ov-pa" style="color:var(--gold)">0</strong></div>
              <div style="display:flex;justify-content:space-between"><span>ğŸ’° Outstanding Revenue</span><strong id="ov-outs" style="color:var(--err)">$0</strong></div>
              <div style="display:flex;justify-content:space-between"><span>ğŸ“… Today's Arrivals</span><strong id="ov-today" style="color:var(--ok)">0</strong></div>
            </div>
          </div>
        </div>

        <!-- Active announcements -->
        <div class="card">
          <div class="sh"><div class="st">ğŸ“¢ Active Announcements</div><button class="btn btn-p btn-sm" onclick="openMod('ann-modal')">+ New</button></div>
          <div id="ov-anns"></div>
        </div>
      </div>

      <!-- â•â• ANALYTICS â•â• -->
      <div id="t-analytics" class="hidden">
        <div class="stats">
          <div class="sc"><div class="sc-ic">ğŸ“Š</div><div class="sc-val" id="an-air">0</div><div class="sc-lbl">Air Packages</div></div>
          <div class="sc" style="--gr:linear-gradient(135deg,#0ea5e9,#38bdf8);--bar:linear-gradient(90deg,#0ea5e9,#38bdf8)"><div class="sc-ic">ğŸš¢</div><div class="sc-val" id="an-sea">0</div><div class="sc-lbl">Sea Packages</div></div>
          <div class="sc" style="--gr:linear-gradient(135deg,#10b981,#059669);--bar:linear-gradient(90deg,#10b981,#059669)"><div class="sc-ic">ğŸ’°</div><div class="sc-val" id="an-paid">$0</div><div class="sc-lbl">Total Collected</div></div>
          <div class="sc" style="--gr:linear-gradient(135deg,#ef4444,#dc2626);--bar:linear-gradient(90deg,#ef4444,#dc2626)"><div class="sc-ic">â³</div><div class="sc-val" id="an-out">$0</div><div class="sc-lbl">Outstanding</div></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="card">
            <div class="st" style="margin-bottom:18px">Mode Split</div>
            <div style="display:flex;gap:18px;align-items:center">
              <div style="position:relative;width:110px;height:110px;flex-shrink:0">
                <svg width="110" height="110" viewBox="0 0 110 110">
                  <circle cx="55" cy="55" r="44" fill="none" stroke="#e2e8f0" stroke-width="12"/>
                  <circle cx="55" cy="55" r="44" fill="none" stroke="url(#ag)" stroke-width="12" stroke-dasharray="var(--air-arc,138) 276" stroke-linecap="round" transform="rotate(-90 55 55)"/>
                  <defs><linearGradient id="ag" x1="0" y1="0" x2="1" y2="0"><stop stop-color="#1a56db"/><stop offset="1" stop-color="#0ea5e9"/></linearGradient></defs>
                  <text x="55" y="59" text-anchor="middle" font-size="14" font-weight="800" fill="#0a1628" font-family="Syne,sans-serif" id="airPct">â€”</text>
                </svg>
              </div>
              <div style="font-size:13px;color:var(--slate);line-height:2.4">
                <div>âœˆï¸ Air: <strong id="an-airCount" style="color:var(--blue)">0 pkgs</strong></div>
                <div>ğŸš¢ Sea: <strong id="an-seaCount" style="color:var(--sky)">0 pkgs</strong></div>
                <div>ğŸ“¦ Total: <strong id="an-totCount" style="color:var(--navy)">0 pkgs</strong></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="st" style="margin-bottom:18px">Branch Distribution</div>
            <div id="branch-chart"></div>
          </div>
        </div>
      </div>

      <!-- â•â• PACKAGES â•â• -->
      <div id="t-packages" class="hidden">
        <div class="sh"><div class="st">Package Management</div><button class="btn btn-p btn-sm" onclick="openMod('add-pkg-modal')">+ Add Package</button></div>
        <div class="search-bar">
          <input class="search-inp" id="pkg-search" placeholder="Search ID, customer, descriptionâ€¦" oninput="renderPkgs()"/>
          <select class="sel" id="pkg-status-filter" onchange="renderPkgs()">
            <option value="all">All Statuses</option>
            <option value="warehouse">In Warehouse</option>
            <option value="transit">In Transit</option>
            <option value="customs">At Customs</option>
            <option value="ready">Ready Pickup</option>
            <option value="delivered">Delivered</option>
          </select>
          <select class="sel" id="pkg-mode-filter" onchange="renderPkgs()">
            <option value="all">All Modes</option>
            <option value="air">âœˆï¸ Air</option>
            <option value="sea">ğŸš¢ Sea</option>
          </select>
        </div>
        <div class="card">
          <div class="tw"><table>
            <thead><tr><th>ID</th><th>Customer</th><th>Description</th><th>Weight</th><th>Mode</th><th>Store</th><th>Arrived</th><th>ETA</th><th>Status</th><th>Cost</th><th>Payment</th><th>Actions</th></tr></thead>
            <tbody id="pkg-table"></tbody>
          </table></div>
        </div>
      </div>

      <!-- â•â• CUSTOMERS â•â• -->
      <div id="t-customers" class="hidden">
        <div class="sh"><div class="st">Customer Accounts</div><button class="btn btn-p btn-sm" onclick="openMod('add-cust-modal')">+ Add Customer</button></div>
        <div class="search-bar">
          <input class="search-inp" id="cust-search" placeholder="Search name, email, member IDâ€¦" oninput="renderCustomers()"/>
          <select class="sel" id="cust-branch-filter" onchange="renderCustomers()">
            <option value="all">All Branches</option>
            <option>Kingston</option><option>Cross Roads</option><option>Portmore</option>
            <option>Montego Bay</option><option>Spanish Town</option><option>Mandeville</option>
          </select>
        </div>
        <div class="card">
          <div class="tw"><table>
            <thead><tr><th>Member ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Branch</th><th>Packages</th><th>Unpaid</th><th>Joined</th><th>Actions</th></tr></thead>
            <tbody id="cust-table"></tbody>
          </table></div>
        </div>
      </div>

      <!-- â•â• PRE-ALERTS â•â• -->
      <div id="t-prealerts" class="hidden">
        <div class="sh"><div class="st">Pre-Alert Management</div><div class="chip" id="pa-chip">0 pending</div></div>
        <div class="card">
          <div class="tw"><table>
            <thead><tr><th>ID</th><th>Customer</th><th>Store</th><th>Description</th><th>Tracking #</th><th>Est. Weight</th><th>Mode</th><th>Status</th><th>Submitted</th><th>Actions</th></tr></thead>
            <tbody id="pa-table"></tbody>
          </table></div>
        </div>
      </div>

      <!-- â•â• TRANSACTIONS â•â• -->
      <div id="t-transactions" class="hidden">
        <div class="sh"><div class="st">Transaction History</div><div class="chip" id="txn-chip">0 transactions</div></div>
        <div class="search-bar">
          <input class="search-inp" id="txn-search" placeholder="Search by reference, customer, invoiceâ€¦" oninput="renderTxns()"/>
        </div>
        <div class="card">
          <div class="tw"><table>
            <thead><tr><th>Reference</th><th>Customer</th><th>Invoice</th><th>Amount</th><th>Method</th><th>Status</th><th>Date</th></tr></thead>
            <tbody id="txn-table"></tbody>
          </table></div>
        </div>
      </div>

      <!-- â•â• ANNOUNCEMENTS â•â• -->
      <div id="t-announcements" class="hidden">
        <div class="sh"><div class="st">Announcements</div><button class="btn btn-p btn-sm" onclick="openMod('ann-modal')">+ New Announcement</button></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div>
            <div class="card" style="margin-bottom:14px">
              <div class="st" style="margin-bottom:4px;font-size:15px">â„¹ï¸ What Announcements Do</div>
              <p style="font-size:13px;color:var(--slate);line-height:1.8;margin-top:8px">Announcements appear on the customer dashboard homepage as alert banners. Use them to notify customers about shipment delays, new branches, rate changes, holidays, or promotions.</p>
            </div>
            <div id="ann-list"></div>
          </div>
          <div class="card">
            <div class="st" style="margin-bottom:18px;font-size:15px">ğŸ“¢ Create Announcement</div>
            <div class="field"><label>Title *</label><input id="ann-title" placeholder="e.g. Holiday Shipping Deadline"/></div>
            <div class="field"><label>Message *</label><textarea id="ann-msg" rows="4" placeholder="Write your message hereâ€¦" style="resize:vertical"></textarea></div>
            <div class="fr2">
              <div class="field"><label>Type</label>
                <select id="ann-type">
                  <option value="info">â„¹ï¸ Info</option>
                  <option value="warn">âš ï¸ Warning</option>
                  <option value="success">âœ… Good News</option>
                  <option value="danger">ğŸš¨ Urgent</option>
                </select>
              </div>
              <div class="field"><label>Expires (optional)</label><input id="ann-exp" type="date"/></div>
            </div>
            <div class="field"><label>Target Audience</label>
              <select id="ann-target">
                <option value="all">All Customers</option>
                <option value="air">Air Freight Customers</option>
                <option value="sea">Sea Freight Customers</option>
                <option value="kingston">Kingston Branch</option>
              </select>
            </div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px">
              <input type="checkbox" id="ann-pinned" style="width:16px;height:16px;accent-color:var(--blue)"/>
              <label for="ann-pinned" style="font-size:13px;color:var(--slate);cursor:pointer">ğŸ“Œ Pin to top of dashboard</label>
            </div>
            <button class="btn btn-p btn-fw" onclick="postAnnouncement()">ğŸ“¢ Post Announcement</button>
          </div>
        </div>
      </div>

      <!-- â•â• RATES â•â• -->
      <div id="t-rates" class="hidden">
        <div class="sh"><div class="st">Rates & Fee Management</div><button class="btn btn-p btn-sm" onclick="saveRates()">ğŸ’¾ Save Rates</button></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
          <div class="card">
            <div class="st" style="margin-bottom:18px;font-size:16px">âœˆï¸ Air Freight</div>
            <div class="field"><label>Rate per lb (USD)</label><input id="rate-air" type="number" step="0.01" value="7.00"/></div>
            <div class="field"><label>Min. Chargeable Weight (lbs)</label><input id="rate-air-min" type="number" step="0.1" value="1.0"/></div>
            <div class="field"><label>Transit Time (days)</label><input id="rate-air-days" placeholder="5-7 Business Days"/></div>
            <div class="field"><label>Departure Schedule</label><input id="rate-air-sched" placeholder="Every Monday & Thursday"/></div>
          </div>
          <div class="card">
            <div class="st" style="margin-bottom:18px;font-size:16px">ğŸš¢ Sea Freight</div>
            <div class="field"><label>Rate per cu ft (USD)</label><input id="rate-sea" type="number" step="0.01" value="35.00"/></div>
            <div class="field"><label>Min. Chargeable Volume (cu ft)</label><input id="rate-sea-min" type="number" step="0.1" value="1.0"/></div>
            <div class="field"><label>Transit Time (weeks)</label><input id="rate-sea-days" placeholder="4-6 Weeks"/></div>
            <div class="field"><label>Departure Schedule</label><input id="rate-sea-sched" placeholder="Every other Friday"/></div>
          </div>
        </div>
        <div class="card">
          <div class="st" style="margin-bottom:18px;font-size:16px">ğŸ›ï¸ Taxes & Duties</div>
          <div class="fr3">
            <div class="field"><label>Import Duty (%)</label><input id="rate-duty" type="number" step="0.1" value="35"/></div>
            <div class="field"><label>GCT (%)</label><input id="rate-gct" type="number" step="0.1" value="15"/></div>
            <div class="field"><label>Handling Fee (USD)</label><input id="rate-handling" type="number" step="0.01" value="0"/></div>
          </div>
          <div class="alert a-info">â„¹ï¸ Rate changes will be reflected on the customer-facing rates page and calculator immediately after saving.</div>
          <button class="btn btn-p" onclick="saveRates()">ğŸ’¾ Save All Rates</button>
        </div>
      </div>

      <!-- â•â• BRANCHES â•â• -->
      <div id="t-branches" class="hidden">
        <div class="sh"><div class="st">Branch Locations</div><button class="btn btn-p btn-sm" onclick="openMod('add-branch-modal')">+ Add Branch</button></div>
        <div class="card">
          <div class="tw"><table>
            <thead><tr><th>Branch Name</th><th>Address</th><th>Phone</th><th>Hours</th><th>Manager</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody id="branch-table"></tbody>
          </table></div>
        </div>
      </div>

      <!-- â•â• SETTINGS â•â• -->
      <div id="t-settings" class="hidden">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div>
            <div class="card" style="margin-bottom:20px">
              <div class="st" style="margin-bottom:18px">ğŸ—„ï¸ Supabase Configuration</div>
              <div class="alert a-info">Connect your Supabase project to enable live data, real auth, and persistent storage.</div>
              <div class="field"><label>Supabase Project URL</label><input id="cfg-url" placeholder="https://xxxx.supabase.co"/></div>
              <div class="field"><label>Supabase Anon Key</label><input id="cfg-key" type="password" placeholder="eyJhbGciOiâ€¦"/></div>
              <button class="btn btn-p btn-fw" onclick="testConnection()">ğŸ”— Test Connection</button>
              <div class="dh"></div>
              <div class="st" style="margin-bottom:14px;font-size:15px">ğŸ“‹ Required Tables (SQL)</div>
              <pre style="background:var(--navy);color:#a5f3fc;border-radius:var(--rmd);padding:16px;font-size:11px;overflow-x:auto;line-height:1.8">CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users,
  member_id TEXT UNIQUE,
  full_name TEXT, first_name TEXT,
  last_name TEXT, email TEXT,
  phone TEXT, branch TEXT,
  role TEXT DEFAULT 'customer',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE packages (
  id TEXT PRIMARY KEY,
  user_id UUID REFERENCES profiles,
  desc TEXT, weight NUMERIC,
  mode TEXT, status TEXT,
  arrived DATE, eta DATE,
  cost_usd NUMERIC, paid BOOLEAN DEFAULT false,
  invoice_id TEXT, store TEXT, notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE prealerts (
  id TEXT PRIMARY KEY,
  user_id UUID REFERENCES profiles,
  store TEXT, tracking_num TEXT,
  desc TEXT, est_weight NUMERIC,
  mode TEXT, status TEXT,
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE transactions (
  id TEXT PRIMARY KEY,
  user_id UUID, package_id TEXT,
  invoice_id TEXT, amount NUMERIC,
  method TEXT, status TEXT,
  reference TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE announcements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT, message TEXT,
  type TEXT DEFAULT 'info',
  target TEXT DEFAULT 'all',
  pinned BOOLEAN DEFAULT false,
  expires DATE, active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE branches (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT, address TEXT,
  phone TEXT, hours TEXT,
  manager TEXT, active BOOLEAN DEFAULT true
);</pre>
            </div>
          </div>
          <div>
            <div class="card" style="margin-bottom:20px">
              <div class="st" style="margin-bottom:14px;font-size:16px">ğŸ” Admin Profile</div>
              <div class="field"><label>Full Name</label><input id="cfg-name" placeholder="Admin Name"/></div>
              <div class="field"><label>Email</label><input id="cfg-email" type="email" placeholder="admin@islandship.jm" readonly style="background:#f1f5f9;cursor:not-allowed"/></div>
              <div class="field"><label>New Password</label><input id="cfg-pass" type="password" placeholder="Leave blank to keep current"/></div>
              <button class="btn btn-p btn-fw" onclick="saveAdminProfile()">ğŸ’¾ Save Profile</button>
            </div>
            <div class="card" style="margin-bottom:20px">
              <div class="st" style="margin-bottom:14px;font-size:16px">ğŸ”— Integrations</div>
              <div style="display:flex;flex-direction:column;gap:10px">
                <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--mist);border-radius:var(--rsm);border:1px solid rgba(26,86,219,.08)">
                  <div><div style="font-weight:600;font-size:13px">ğŸ…¿ï¸ PayPal Business</div><div style="font-size:11px;color:var(--slate)">Accept online payments</div></div>
                  <button class="btn btn-g btn-sm" onclick="showToast('info','Connect via PayPal Developer Dashboard')">Configure</button>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--mist);border-radius:var(--rsm);border:1px solid rgba(26,86,219,.08)">
                  <div><div style="font-weight:600;font-size:13px">ğŸ“§ Email (SMTP)</div><div style="font-size:11px;color:var(--slate)">Tracking & invoice emails</div></div>
                  <button class="btn btn-g btn-sm" onclick="showToast('info','Configure in Supabase Auth settings')">Configure</button>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--mist);border-radius:var(--rsm);border:1px solid rgba(26,86,219,.08)">
                  <div><div style="font-weight:600;font-size:13px">ğŸ“± SMS (Twilio)</div><div style="font-size:11px;color:var(--slate)">Package update SMS alerts</div></div>
                  <button class="btn btn-g btn-sm" onclick="showToast('info','Add Twilio credentials to Supabase Edge Functions')">Configure</button>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--mist);border-radius:var(--rsm);border:1px solid rgba(26,86,219,.08)">
                  <div><div style="font-weight:600;font-size:13px">ğŸŒ Custom Domain</div><div style="font-size:11px;color:var(--slate)">Connect islandship.jm</div></div>
                  <button class="btn btn-g btn-sm" onclick="showToast('info','Update DNS CNAME record to your host')">Configure</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /pc -->
  </div><!-- /main -->
</div><!-- /app -->

<!-- â•â•â• MODALS â•â•â• -->

<!-- ADD PACKAGE -->
<div class="mo" id="add-pkg-modal">
  <div class="md md-lg">
    <div class="md-head"><button class="md-close" onclick="closeMod('add-pkg-modal')">Ã—</button><h3>ğŸ“¦ Add New Package</h3><p>Enter package details to add to the system</p></div>
    <div class="md-body">
      <div class="fr2">
        <div class="field"><label>Customer (Member ID) *</label>
          <select id="pkg-cust-sel"><option value="">Select customerâ€¦</option></select>
        </div>
        <div class="field"><label>Store / Merchant</label><input id="pkg-store" placeholder="Amazon, Nikeâ€¦"/></div>
      </div>
      <div class="field"><label>Description *</label><input id="pkg-desc" placeholder="Nike Air Max 270 Ã— 2 â€” Black, Size 10"/></div>
      <div class="fr3">
        <div class="field"><label>Weight (lbs) *</label><input id="pkg-weight" type="number" step="0.1" placeholder="3.5"/></div>
        <div class="field"><label>Mode *</label><select id="pkg-mode"><option value="air">âœˆï¸ Air Freight</option><option value="sea">ğŸš¢ Sea Freight</option></select></div>
        <div class="field"><label>Cost (USD)</label><input id="pkg-cost" type="number" step="0.01" placeholder="24.50"/></div>
      </div>
      <div class="fr3">
        <div class="field"><label>Status</label>
          <select id="pkg-status">
            <option value="warehouse">ğŸ“¦ In Warehouse</option>
            <option value="transit">âœˆï¸ In Transit</option>
            <option value="customs">ğŸ›ƒ At Customs</option>
            <option value="ready">âœ… Ready Pickup</option>
            <option value="delivered">ğŸ  Delivered</option>
          </select>
        </div>
        <div class="field"><label>Arrived Date</label><input id="pkg-arrived" type="date"/></div>
        <div class="field"><label>ETA Date</label><input id="pkg-eta" type="date"/></div>
      </div>
      <div class="field"><label>Notes</label><textarea id="pkg-notes" rows="2" placeholder="Fragile, special handling, etc." style="resize:vertical"></textarea></div>
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px">
        <input type="checkbox" id="pkg-paid" style="width:16px;height:16px;accent-color:var(--blue)"/>
        <label for="pkg-paid" style="font-size:13px;cursor:pointer">Mark as Paid</label>
      </div>
      <div style="display:flex;gap:10px">
        <button class="btn btn-p btn-lg" style="flex:1" onclick="addPackage()">Add Package</button>
        <button class="btn btn-g btn-lg" style="flex:1" onclick="closeMod('add-pkg-modal')">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT PACKAGE -->
<div class="mo" id="edit-pkg-modal">
  <div class="md">
    <div class="md-head"><button class="md-close" onclick="closeMod('edit-pkg-modal')">Ã—</button><h3>âœï¸ Edit Package</h3><p id="edit-pkg-subtitle">Package ID</p></div>
    <div class="md-body">
      <div class="fr2">
        <div class="field"><label>Status</label>
          <select id="ep-status">
            <option value="warehouse">ğŸ“¦ In Warehouse</option>
            <option value="transit">âœˆï¸ In Transit</option>
            <option value="customs">ğŸ›ƒ At Customs</option>
            <option value="ready">âœ… Ready Pickup</option>
            <option value="delivered">ğŸ  Delivered</option>
          </select>
        </div>
        <div class="field"><label>ETA Date</label><input id="ep-eta" type="date"/></div>
      </div>
      <div class="fr2">
        <div class="field"><label>Cost (USD)</label><input id="ep-cost" type="number" step="0.01"/></div>
        <div class="field"><label>Weight (lbs)</label><input id="ep-weight" type="number" step="0.1"/></div>
      </div>
      <div class="field"><label>Notes</label><textarea id="ep-notes" rows="2" style="resize:vertical"></textarea></div>
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px">
        <input type="checkbox" id="ep-paid" style="width:16px;height:16px;accent-color:var(--blue)"/>
        <label for="ep-paid" style="font-size:13px;cursor:pointer">Mark as Paid</label>
      </div>
      <button class="btn btn-p btn-fw btn-lg" onclick="saveEditPkg()">ğŸ’¾ Save Changes</button>
    </div>
  </div>
</div>

<!-- ADD CUSTOMER -->
<div class="mo" id="add-cust-modal">
  <div class="md">
    <div class="md-head"><button class="md-close" onclick="closeMod('add-cust-modal')">Ã—</button><h3>ğŸ‘¤ Add Customer</h3><p>Manually create a customer account</p></div>
    <div class="md-body">
      <div class="fr2">
        <div class="field"><label>First Name *</label><input id="nc-first" placeholder="Paul"/></div>
        <div class="field"><label>Last Name *</label><input id="nc-last" placeholder="Medley"/></div>
      </div>
      <div class="field"><label>Email *</label><input id="nc-email" type="email" placeholder="paul@email.com"/></div>
      <div class="fr2">
        <div class="field"><label>Phone</label><input id="nc-phone" placeholder="876-xxx-xxxx"/></div>
        <div class="field"><label>Branch</label>
          <select id="nc-branch"><option>Kingston</option><option>Cross Roads</option><option>Portmore</option><option>Montego Bay</option><option>Spanish Town</option><option>Mandeville</option><option>Ocho Rios</option></select>
        </div>
      </div>
      <div class="field"><label>Temporary Password *</label><input id="nc-pass" type="password" placeholder="Min 8 characters"/></div>
      <button class="btn btn-p btn-fw btn-lg" onclick="addCustomer()">Create Account</button>
    </div>
  </div>
</div>

<!-- ANNOUNCEMENT MODAL -->
<div class="mo" id="ann-modal">
  <div class="md">
    <div class="md-head"><button class="md-close" onclick="closeMod('ann-modal')">Ã—</button><h3>ğŸ“¢ New Announcement</h3><p>Post a message visible to all customers</p></div>
    <div class="md-body">
      <div class="field"><label>Title *</label><input id="m-ann-title" placeholder="e.g. Holiday Shipping Notice"/></div>
      <div class="field"><label>Message *</label><textarea id="m-ann-msg" rows="4" placeholder="Write your announcementâ€¦" style="resize:vertical"></textarea></div>
      <div class="fr2">
        <div class="field"><label>Type</label>
          <select id="m-ann-type"><option value="info">â„¹ï¸ Info</option><option value="warn">âš ï¸ Warning</option><option value="success">âœ… Good News</option><option value="danger">ğŸš¨ Urgent</option></select>
        </div>
        <div class="field"><label>Expires</label><input id="m-ann-exp" type="date"/></div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px">
        <input type="checkbox" id="m-ann-pin" style="width:16px;height:16px;accent-color:var(--blue)"/>
        <label for="m-ann-pin" style="font-size:13px;cursor:pointer">ğŸ“Œ Pin to top</label>
      </div>
      <button class="btn btn-p btn-fw btn-lg" onclick="postAnnModal()">ğŸ“¢ Post Now</button>
    </div>
  </div>
</div>

<!-- CUSTOMER DETAIL -->
<div class="mo" id="cust-detail-modal">
  <div class="md md-lg">
    <div class="md-head"><button class="md-close" onclick="closeMod('cust-detail-modal')">Ã—</button><h3 id="cd-name">Customer Details</h3><p id="cd-id">Member ID</p></div>
    <div class="md-body" id="cd-body"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUPABASE CONFIG â€” Replace with your values
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SUPABASE_URL = 'https://ooibkptrshpdinjhgjfs.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vaWJrcHRyc2hwZGluamhnamZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0NzAzMDgsImV4cCI6MjA4NzA0NjMwOH0.ZBzMeqREi1tQ40ZZ4_p9nJKDkzPNK_bP1g7IsRvcE6c';

let sb = null;
let adminUser = null;
let allPkgs = [], allCustomers = [], allPA = [], allTxns = [], allAnns = [], allBranches = [];
let editingPkgId = null;

// INIT
if(SUPABASE_URL !== 'https://YOUR_PROJECT.supabase.co'){
  sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  sb.auth.onAuthStateChange(async (event, session) => {
    adminUser = session?.user ?? null;
    if(adminUser){ await checkAdminRole(); await loadAll(); }
    else { window.location.href = 'islandship-part1-landing-auth.html'; }
  });
} else {
  loadDemo();
}

async function checkAdminRole(){
  const {data} = await sb.from('profiles').select('role,full_name,email').eq('id', adminUser.id).single();
  if(data?.role !== 'admin'){ showToast('err','Access denied. Admin only.'); setTimeout(()=>window.location.href='islandship-part2-customer-dashboard.html',1500); return; }
  document.getElementById('adminName').textContent = data.full_name || adminUser.email;
  document.getElementById('adminAvatar').textContent = (data.full_name||'A')[0].toUpperCase();
}

/* â•â•â• DEMO DATA â•â•â• */
function loadDemo(){
  adminUser = {id:'admin', email:'admin@islandship.jm'};
  document.getElementById('adminName').textContent = 'Admin User';
  document.getElementById('cfg-email').value = 'admin@islandship.jm';

  allCustomers = [
    {id:'c1',member_id:'BAL-10349',full_name:'Paul Medley',first_name:'Paul',last_name:'Medley',email:'paul@email.com',phone:'876-371-9167',branch:'Cross Roads',role:'customer',created_at:'2026-01-31'},
    {id:'c2',member_id:'BAL-10350',full_name:'Kezia Morgan',first_name:'Kezia',last_name:'Morgan',email:'kezia@email.com',phone:'876-560-2211',branch:'Kingston',role:'customer',created_at:'2026-02-01'},
    {id:'c3',member_id:'BAL-10351',full_name:'Devon Clarke',first_name:'Devon',last_name:'Clarke',email:'devon@email.com',phone:'876-712-4438',branch:'Portmore',role:'customer',created_at:'2026-02-05'},
    {id:'c4',member_id:'BAL-10352',full_name:'Simone Reid',first_name:'Simone',last_name:'Reid',email:'simone@email.com',phone:'876-331-8892',branch:'Montego Bay',role:'customer',created_at:'2026-02-08'},
  ];
  allPkgs = [
    {id:'PKG-2026-0001',user_id:'c1',desc:'Nike Air Max 270 Ã— 2',weight:3.2,mode:'air',status:'transit',arrived:'2026-02-10',eta:'2026-02-20',cost_usd:22.40,paid:true,invoice_id:'INV-001',store:'Nike.com',notes:''},
    {id:'PKG-2026-0002',user_id:'c1',desc:'iPhone 15 Pro Case + Screen Protector',weight:0.8,mode:'air',status:'warehouse',arrived:'2026-02-14',eta:'2026-02-21',cost_usd:5.60,paid:false,invoice_id:'INV-002',store:'Amazon',notes:''},
    {id:'PKG-2026-0003',user_id:'c1',desc:'CeraVe Skincare Bundle (6 items)',weight:4.1,mode:'sea',status:'delivered',arrived:'2026-01-15',eta:'2026-02-05',cost_usd:143.50,paid:true,invoice_id:'INV-003',store:'Ulta',notes:''},
    {id:'PKG-2026-0004',user_id:'c2',desc:'MacBook Pro Sleeve + Accessories',weight:1.5,mode:'air',status:'customs',arrived:'2026-02-11',eta:'2026-02-19',cost_usd:10.50,paid:true,invoice_id:'INV-004',store:'Amazon',notes:''},
    {id:'PKG-2026-0005',user_id:'c3',desc:'Vitamins & Supplements Set',weight:6.2,mode:'sea',status:'warehouse',arrived:'2026-02-16',eta:'2026-03-10',cost_usd:217.00,paid:false,invoice_id:'INV-005',store:'iHerb',notes:'Fragile'},
    {id:'PKG-2026-0006',user_id:'c4',desc:'Dyson Airwrap Complete',weight:2.8,mode:'air',status:'ready',arrived:'2026-02-12',eta:'2026-02-18',cost_usd:19.60,paid:false,invoice_id:'INV-006',store:'Dyson',notes:''},
  ];
  allPA = [
    {id:'PA-001',user_id:'c1',store:'Amazon',tracking_num:'1Z999AA123',desc:'Laptop Stand',est_weight:2.5,mode:'air',status:'pending',created_at:'2026-02-15'},
    {id:'PA-002',user_id:'c2',store:'Walmart',tracking_num:'',desc:'Office Chair',est_weight:35,mode:'sea',status:'received',created_at:'2026-02-13'},
  ];
  allTxns = [
    {id:'TXN-001',user_id:'c1',package_id:'PKG-2026-0001',invoice_id:'INV-001',amount:22.40*1.35*1.15,method:'PayPal',status:'completed',reference:'PP-8765432',created_at:'2026-02-10'},
    {id:'TXN-002',user_id:'c1',package_id:'PKG-2026-0003',invoice_id:'INV-003',amount:143.50*1.35*1.15,method:'Card',status:'completed',reference:'CH-1234567',created_at:'2026-01-15'},
    {id:'TXN-003',user_id:'c2',package_id:'PKG-2026-0004',invoice_id:'INV-004',amount:10.50*1.35*1.15,method:'Lynk',status:'completed',reference:'LK-9988776',created_at:'2026-02-12'},
  ];
  allAnns = [
    {id:'ann1',title:'Weekly Air Departure â€” Monday',message:'Our next air freight departure is Monday, February 24. Please ensure all packages are pre-alerted by Friday.',type:'info',pinned:true,active:true,created_at:'2026-02-17',target:'all'},
    {id:'ann2',title:'New Branch Opening â€” Montego Bay',message:'We are excited to announce the opening of our new MoBay branch on March 1st. Extended hours 8amâ€“7pm.',type:'success',pinned:false,active:true,created_at:'2026-02-15',target:'all'},
  ];
  allBranches = [
    {id:'b1',name:'Kingston HQ',address:'15 King St, Kingston',phone:'876-555-0100',hours:'Monâ€“Sat 8amâ€“6pm',manager:'Janet Brown',active:true},
    {id:'b2',name:'Cross Roads',address:'22 Maxfield Ave, Cross Roads',phone:'876-555-0102',hours:'Monâ€“Sat 9amâ€“6pm',manager:'Rodney Green',active:true},
    {id:'b3',name:'Portmore',address:'Portmore Mall, Lot 5',phone:'876-555-0103',hours:'Monâ€“Sat 9amâ€“5pm',manager:'Tracey White',active:true},
    {id:'b4',name:'Montego Bay',address:'10 Barnett St, MoBay',phone:'876-555-0104',hours:'Monâ€“Sat 8amâ€“6pm',manager:'(Opening Soon)',active:false},
  ];
  renderAll();
}

/* â•â•â• SUPABASE LOAD â•â•â• */
async function loadAll(){
  const [pkgs, custs, pa, txns, anns, branches] = await Promise.all([
    sb.from('packages').select('*').order('created_at',{ascending:false}),
    sb.from('profiles').select('*').eq('role','customer').order('created_at',{ascending:false}),
    sb.from('prealerts').select('*').order('created_at',{ascending:false}),
    sb.from('transactions').select('*').order('created_at',{ascending:false}),
    sb.from('announcements').select('*').eq('active',true).order('pinned',{ascending:false}),
    sb.from('branches').select('*').order('name'),
  ]);
  allPkgs      = pkgs.data||[];
  allCustomers = custs.data||[];
  allPA        = pa.data||[];
  allTxns      = txns.data||[];
  allAnns      = anns.data||[];
  allBranches  = branches.data||[];
  renderAll();
}

/* â•â•â• RENDER ALL â•â•â• */
function renderAll(){ updateStats(); renderPkgs(); renderCustomers(); renderPA(); renderTxns(); renderAnns(); renderBranches(); populateCustSelect(); updateAnalytics(); }

/* â•â•â• HELPERS â•â•â• */
const STC = {warehouse:{l:'In Warehouse',i:'ğŸ“¦',c:'b-wh'},transit:{l:'In Transit',i:'âœˆï¸',c:'b-tr'},customs:{l:'At Customs',i:'ğŸ›ƒ',c:'b-cu'},ready:{l:'Ready Pickup',i:'âœ…',c:'b-rd'},delivered:{l:'Delivered',i:'ğŸ ',c:'b-dl'}};
function stBadge(s){ const m=STC[s]||{l:s,i:'?',c:'b-wh'}; return `<span class="badge ${m.c}">${m.i} ${m.l}</span>`; }
function payBadge(p){ return p?`<span class="badge b-paid">âœ“ Paid</span>`:`<span class="badge b-un">âœ— Unpaid</span>`; }
function cName(uid){ const c=allCustomers.find(c=>c.id===uid); return c?c.full_name:'Unknown'; }
function cMid(uid){ return allCustomers.find(c=>c.id===uid)?.member_id||uid; }
const ANTYPE = {info:{bg:'rgba(26,86,219,.07)',bd:'rgba(26,86,219,.18)',ic:'â„¹ï¸',tc:'#1e40af'},warn:{bg:'rgba(245,158,11,.06)',bd:'rgba(245,158,11,.22)',ic:'âš ï¸',tc:'#b45309'},success:{bg:'rgba(16,185,129,.06)',bd:'rgba(16,185,129,.22)',ic:'âœ…',tc:'#065f46'},danger:{bg:'rgba(239,68,68,.06)',bd:'rgba(239,68,68,.2)',ic:'ğŸš¨',tc:'#b91c1c'}};

/* â•â•â• STATS â•â•â• */
function updateStats(){
  const p=allPkgs, wh=p.filter(x=>x.status==='warehouse').length, tr=p.filter(x=>x.status==='transit').length,
        cu=p.filter(x=>x.status==='customs').length, dl=p.filter(x=>x.status==='delivered').length,
        up=p.filter(x=>!x.paid).length, rev=p.filter(x=>x.paid).reduce((s,x)=>s+(x.cost_usd||0)*1.35*1.15,0),
        pa=allPA.filter(x=>x.status==='pending').length;
  document.getElementById('sv-total').textContent=p.length;
  document.getElementById('sv-wh').textContent=wh;
  document.getElementById('sv-tr').textContent=tr;
  document.getElementById('sv-cu').textContent=cu;
  document.getElementById('sv-dl').textContent=dl;
  document.getElementById('sv-up').textContent=up;
  document.getElementById('sv-rev').textContent='$'+rev.toFixed(0);
  document.getElementById('sv-cust').textContent=allCustomers.length;
  document.getElementById('ov-pa').textContent=pa;
  document.getElementById('ov-outs').textContent='$'+p.filter(x=>!x.paid).reduce((s,x)=>s+(x.cost_usd||0)*1.35*1.15,0).toFixed(0);
  document.getElementById('ov-today').textContent=p.filter(x=>x.arrived===new Date().toISOString().slice(0,10)).length;
  const nb=document.getElementById('nb-packages'); nb.textContent=up; nb.style.display=up>0?'flex':'none';
  const nbpa=document.getElementById('nb-prealerts'); nbpa.textContent=pa; nbpa.style.display=pa>0?'flex':'none';
  renderStatusChart(wh,tr,cu,p.filter(x=>x.status==='ready').length,dl);
  document.getElementById('ov-pkgs').innerHTML=p.slice(0,6).map(pkg=>`
    <tr><td class="tid">${pkg.id}</td><td>${cName(pkg.user_id)}</td><td style="max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${pkg.desc}</td><td>${stBadge(pkg.status)}</td><td style="font-weight:600">$${(pkg.cost_usd||0).toFixed(0)}</td>
    <td><button class="btn btn-g btn-sm" onclick="editPkg('${pkg.id}')">Edit</button></td></tr>`).join('');
}

/* â•â•â• STATUS CHART â•â•â• */
function renderStatusChart(wh,tr,cu,rd,dl){
  const data=[{l:'Warehouse',v:wh,c:'#f59e0b'},{l:'Transit',v:tr,c:'#0ea5e9'},{l:'Customs',v:cu,c:'#f97316'},{l:'Ready',v:rd,c:'#10b981'},{l:'Delivered',v:dl,c:'#64748b'}];
  const max=Math.max(...data.map(d=>d.v),1);
  document.getElementById('status-chart').innerHTML=data.map(d=>`
    <div class="bar-col">
      <div class="bar-val">${d.v}</div>
      <div class="bar" style="--h:${Math.max(d.v/max*90,4)}px;background:${d.c}"></div>
      <div class="bar-lbl">${d.l}</div>
    </div>`).join('');
}

/* â•â•â• ANALYTICS â•â•â• */
function updateAnalytics(){
  const air=allPkgs.filter(p=>p.mode==='air').length, sea=allPkgs.filter(p=>p.mode==='sea').length, tot=allPkgs.length;
  const paid=allPkgs.filter(p=>p.paid).reduce((s,p)=>s+(p.cost_usd||0)*1.35*1.15,0);
  const out=allPkgs.filter(p=>!p.paid).reduce((s,p)=>s+(p.cost_usd||0)*1.35*1.15,0);
  document.getElementById('an-air').textContent=air;
  document.getElementById('an-sea').textContent=sea;
  document.getElementById('an-paid').textContent='$'+paid.toFixed(0);
  document.getElementById('an-out').textContent='$'+out.toFixed(0);
  document.getElementById('an-airCount').textContent=air+' pkgs';
  document.getElementById('an-seaCount').textContent=sea+' pkgs';
  document.getElementById('an-totCount').textContent=tot+' pkgs';
  document.getElementById('airPct').textContent=tot>0?Math.round(air/tot*100)+'%':'â€”';
  const circle=document.querySelector('[style*="--air-arc"]');
  if(circle) circle.style.cssText=circle.style.cssText.replace(/--air-arc:[^;]+/,`--air-arc:${tot>0?Math.round(air/tot*276):0}`);
  // Branch chart
  const branches=['Kingston','Cross Roads','Portmore','Montego Bay','Spanish Town','Other'];
  const bData=branches.map(b=>({b,count:allCustomers.filter(c=>c.branch===b).length}));
  const bMax=Math.max(...bData.map(d=>d.count),1);
  document.getElementById('branch-chart').innerHTML=`<div style="display:flex;flex-direction:column;gap:10px">${bData.filter(d=>d.count>0).map(d=>`
    <div><div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px"><span style="color:var(--mid)">${d.b}</span><strong style="color:var(--blue)">${d.count}</strong></div>
    <div class="prog-track"><div class="prog-fill" style="--w:${d.count/bMax*100}%"></div></div></div>`).join('')||'<p style="color:var(--slate);font-size:13px">No customer data yet</p>'}</div>`;
}

/* â•â•â• PACKAGES TABLE â•â•â• */
function renderPkgs(){
  const s=document.getElementById('pkg-search')?.value.toLowerCase()||'';
  const sf=document.getElementById('pkg-status-filter')?.value||'all';
  const mf=document.getElementById('pkg-mode-filter')?.value||'all';
  const filtered=allPkgs.filter(p=>{
    const ms=p.id.toLowerCase().includes(s)||p.desc.toLowerCase().includes(s)||(cName(p.user_id)||'').toLowerCase().includes(s)||(cMid(p.user_id)||'').toLowerCase().includes(s);
    return ms&&(sf==='all'||p.status===sf)&&(mf==='all'||p.mode===mf);
  });
  document.getElementById('pkg-table').innerHTML=filtered.map(p=>`
    <tr>
      <td class="tid">${p.id}</td>
      <td><div style="font-weight:600;font-size:12px">${cName(p.user_id)}</div><div style="font-size:10px;color:var(--slate)">${cMid(p.user_id)}</div></td>
      <td style="max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.desc}</td>
      <td>${p.weight} lbs</td>
      <td>${p.mode==='air'?'âœˆï¸':'ğŸš¢'}</td>
      <td style="font-size:12px;color:var(--slate)">${p.store||'â€”'}</td>
      <td style="font-size:12px;color:var(--slate)">${p.arrived||'â€”'}</td>
      <td style="font-size:12px;color:${p.status==='delivered'?'var(--ok)':'var(--blue)'}">${p.eta||'â€”'}</td>
      <td>${stBadge(p.status)}</td>
      <td style="font-weight:600">$${(p.cost_usd||0).toFixed(2)}</td>
      <td>${payBadge(p.paid)}</td>
      <td style="white-space:nowrap">
        <button class="btn btn-g btn-sm" onclick="editPkg('${p.id}')">âœï¸ Edit</button>
        ${!p.paid?`<button class="btn btn-ok btn-sm" style="margin-left:4px" onclick="markPaid('${p.id}')">âœ“ Paid</button>`:''}
      </td>
    </tr>`).join('')||`<tr><td colspan="12" style="text-align:center;padding:36px;color:var(--slate)">No packages found</td></tr>`;
}

/* â•â•â• EDIT PACKAGE â•â•â• */
function editPkg(id){
  const p=allPkgs.find(x=>x.id===id); if(!p) return;
  editingPkgId=id;
  document.getElementById('edit-pkg-subtitle').textContent=id;
  document.getElementById('ep-status').value=p.status;
  document.getElementById('ep-eta').value=p.eta||'';
  document.getElementById('ep-cost').value=p.cost_usd||'';
  document.getElementById('ep-weight').value=p.weight||'';
  document.getElementById('ep-notes').value=p.notes||'';
  document.getElementById('ep-paid').checked=!!p.paid;
  openMod('edit-pkg-modal');
}
async function saveEditPkg(){
  const updates={status:document.getElementById('ep-status').value,eta:document.getElementById('ep-eta').value||null,cost_usd:parseFloat(document.getElementById('ep-cost').value)||0,weight:parseFloat(document.getElementById('ep-weight').value)||0,notes:document.getElementById('ep-notes').value,paid:document.getElementById('ep-paid').checked};
  if(sb){ const {error}=await sb.from('packages').update(updates).eq('id',editingPkgId); if(error){showToast('err',error.message);return;} await loadAll(); }
  else{ const idx=allPkgs.findIndex(p=>p.id===editingPkgId); if(idx>-1) allPkgs[idx]={...allPkgs[idx],...updates}; renderAll(); }
  closeMod('edit-pkg-modal'); showToast('ok','âœ… Package updated!');
}
async function markPaid(id){
  if(sb){ await sb.from('packages').update({paid:true}).eq('id',id); await loadAll(); }
  else{ const i=allPkgs.findIndex(p=>p.id===id); if(i>-1) allPkgs[i].paid=true; renderAll(); }
  showToast('ok','âœ… Marked as paid!');
}

/* â•â•â• ADD PACKAGE â•â•â• */
async function addPackage(){
  const uid=document.getElementById('pkg-cust-sel').value;
  const desc=document.getElementById('pkg-desc').value.trim();
  const weight=parseFloat(document.getElementById('pkg-weight').value)||0;
  if(!uid||!desc||!weight){showToast('err','Customer, description and weight are required.');return;}
  const pkg={
    id:'PKG-'+Date.now(),user_id:uid,
    desc,weight,
    mode:document.getElementById('pkg-mode').value,
    status:document.getElementById('pkg-status').value,
    arrived:document.getElementById('pkg-arrived').value||new Date().toISOString().slice(0,10),
    eta:document.getElementById('pkg-eta').value||null,
    cost_usd:parseFloat(document.getElementById('pkg-cost').value)||weight*7,
    paid:document.getElementById('pkg-paid').checked,
    invoice_id:'INV-'+Date.now().toString().slice(-6),
    store:document.getElementById('pkg-store').value.trim(),
    notes:document.getElementById('pkg-notes').value.trim(),
    created_at:new Date().toISOString()
  };
  if(sb){ const {error}=await sb.from('packages').insert(pkg); if(error){showToast('err',error.message);return;} await loadAll(); }
  else{ allPkgs.unshift(pkg); renderAll(); }
  closeMod('add-pkg-modal'); showToast('ok','ğŸ“¦ Package added!');
  ['pkg-desc','pkg-store','pkg-weight','pkg-cost','pkg-notes','pkg-arrived','pkg-eta'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('pkg-paid').checked=false;
}

/* â•â•â• CUSTOMERS â•â•â• */
function renderCustomers(){
  const s=document.getElementById('cust-search')?.value.toLowerCase()||'';
  const bf=document.getElementById('cust-branch-filter')?.value||'all';
  const list=allCustomers.filter(c=>{
    const ms=c.full_name?.toLowerCase().includes(s)||c.email?.toLowerCase().includes(s)||c.member_id?.toLowerCase().includes(s);
    return ms&&(bf==='all'||c.branch===bf);
  });
  const pkgCount=uid=>allPkgs.filter(p=>p.user_id===uid).length;
  const unpaidCount=uid=>allPkgs.filter(p=>p.user_id===uid&&!p.paid).length;
  document.getElementById('cust-table').innerHTML=list.map(c=>`
    <tr>
      <td class="tid">${c.member_id}</td>
      <td><div style="display:flex;align-items:center;gap:8px"><div style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;font-weight:700;font-size:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0">${(c.full_name||'?')[0]}</div><span style="font-weight:600">${c.full_name}</span></div></td>
      <td style="font-size:12px;color:var(--slate)">${c.email}</td>
      <td style="font-size:12px;color:var(--slate)">${c.phone||'â€”'}</td>
      <td><span class="chip">${c.branch||'â€”'}</span></td>
      <td style="text-align:center"><strong style="color:var(--blue)">${pkgCount(c.id)}</strong></td>
      <td style="text-align:center"><strong style="color:${unpaidCount(c.id)>0?'var(--err)':'var(--ok)'}">${unpaidCount(c.id)}</strong></td>
      <td style="font-size:11px;color:var(--slate)">${(c.created_at||'').slice(0,10)}</td>
      <td><button class="btn btn-g btn-sm" onclick="viewCustomer('${c.id}')">ğŸ‘¤ View</button></td>
    </tr>`).join('')||`<tr><td colspan="9" style="text-align:center;padding:36px;color:var(--slate)">No customers found</td></tr>`;
}

function viewCustomer(id){
  const c=allCustomers.find(x=>x.id===id); if(!c) return;
  const pkgs=allPkgs.filter(p=>p.user_id===id);
  document.getElementById('cd-name').textContent=c.full_name;
  document.getElementById('cd-id').textContent=c.member_id+' Â· '+c.email;
  document.getElementById('cd-body').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:22px">
      <div>
        <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--slate);margin-bottom:8px">Contact Info</div>
        <div style="font-size:13px;color:var(--mid);line-height:2.2">${c.email}<br>${c.phone||'No phone'}<br>ğŸ“ ${c.branch||'No branch'}</div>
      </div>
      <div>
        <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--slate);margin-bottom:8px">US Shipping Address</div>
        <div style="font-size:12px;color:var(--mid);background:var(--mist);border-radius:var(--rsm);padding:10px;line-height:1.9">${c.full_name} (${c.member_id})<br>2750 NW 87th Ave, Suite 100<br>Miami, FL 33172, USA</div>
      </div>
    </div>
    <div style="font-family:var(--fh);font-size:15px;font-weight:600;margin-bottom:14px">ğŸ“¦ Packages (${pkgs.length})</div>
    <div style="overflow-x:auto"><table><thead><tr><th>ID</th><th>Description</th><th>Status</th><th>Cost</th><th>Paid</th></tr></thead><tbody>
      ${pkgs.map(p=>`<tr><td class="tid">${p.id}</td><td style="font-size:12px">${p.desc}</td><td>${stBadge(p.status)}</td><td style="font-weight:600">$${(p.cost_usd||0).toFixed(2)}</td><td>${payBadge(p.paid)}</td></tr>`).join('')||'<tr><td colspan="5" style="text-align:center;padding:18px;color:var(--slate);font-size:13px">No packages</td></tr>'}
    </tbody></table></div>
    <div style="margin-top:18px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn btn-p btn-sm" onclick="showToast('info','Email feature requires SMTP integration')">ğŸ“§ Email Customer</button>
      <button class="btn btn-g btn-sm" onclick="showToast('info','SMS requires Twilio integration')">ğŸ“± Send SMS</button>
      <button class="btn btn-o btn-sm" onclick="closeMod('cust-detail-modal')">Close</button>
    </div>`;
  openMod('cust-detail-modal');
}

async function addCustomer(){
  const first=document.getElementById('nc-first').value.trim(), last=document.getElementById('nc-last').value.trim();
  const email=document.getElementById('nc-email').value.trim(), pass=document.getElementById('nc-pass').value;
  if(!first||!last||!email||!pass){showToast('err','Fill all required fields.');return;}
  if(pass.length<8){showToast('err','Password min 8 chars.');return;}
  const cust={id:'c-'+Date.now(),member_id:'BAL-'+Math.floor(10000+Math.random()*90000),full_name:`${first} ${last}`,first_name:first,last_name:last,email,phone:document.getElementById('nc-phone').value,branch:document.getElementById('nc-branch').value,role:'customer',created_at:new Date().toISOString()};
  if(sb){
    const {data,error}=await sb.auth.admin.createUser({email,password:pass,user_metadata:{full_name:cust.full_name}});
    if(error){showToast('err',error.message);return;}
    await sb.from('profiles').insert({...cust,id:data.user.id});
    await loadAll();
  } else { allCustomers.unshift(cust); renderAll(); }
  closeMod('add-cust-modal'); showToast('ok','ğŸ‘¤ Customer account created!');
  ['nc-first','nc-last','nc-email','nc-phone','nc-pass'].forEach(id=>document.getElementById(id).value='');
}

function populateCustSelect(){
  const s=document.getElementById('pkg-cust-sel'); if(!s) return;
  s.innerHTML='<option value="">Select customerâ€¦</option>'+allCustomers.map(c=>`<option value="${c.id}">${c.member_id} â€” ${c.full_name}</option>`).join('');
}

/* â•â•â• PRE-ALERTS â•â•â• */
function renderPA(){
  const pending=allPA.filter(x=>x.status==='pending').length;
  document.getElementById('pa-chip').textContent=`${pending} pending`;
  document.getElementById('pa-table').innerHTML=allPA.map(a=>{
    const c=allCustomers.find(x=>x.id===a.user_id);
    return `<tr>
      <td class="tid">${a.id}</td>
      <td><div style="font-weight:600;font-size:12px">${c?.full_name||'Unknown'}</div><div style="font-size:10px;color:var(--slate)">${c?.member_id||a.user_id}</div></td>
      <td>${a.store||'â€”'}</td>
      <td style="max-width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${a.desc}</td>
      <td style="font-size:11px;color:var(--slate)">${a.tracking_num||'â€”'}</td>
      <td>${a.est_weight||'â€”'} lbs</td>
      <td>${a.mode==='air'?'âœˆï¸':'ğŸš¢'}</td>
      <td><span class="badge ${a.status==='pending'?'b-wh':'b-rd'}">${a.status==='pending'?'â³ Pending':'âœ… Received'}</span></td>
      <td style="font-size:11px;color:var(--slate)">${(a.created_at||'').slice(0,10)}</td>
      <td>${a.status==='pending'?`<button class="btn btn-ok btn-sm" onclick="receivePA('${a.id}')">Mark Received</button>`:'<span style="color:var(--slate);font-size:12px">Done</span>'}</td>
    </tr>`;}).join('')||`<tr><td colspan="10" style="text-align:center;padding:36px;color:var(--slate)">No pre-alerts</td></tr>`;
}
async function receivePA(id){
  if(sb){ await sb.from('prealerts').update({status:'received'}).eq('id',id); await loadAll(); }
  else{ const i=allPA.findIndex(a=>a.id===id); if(i>-1) allPA[i].status='received'; renderAll(); }
  showToast('ok','ğŸ“¬ Pre-alert marked received!');
}

/* â•â•â• TRANSACTIONS â•â•â• */
function renderTxns(){
  const s=document.getElementById('txn-search')?.value.toLowerCase()||'';
  const list=allTxns.filter(t=>t.reference?.toLowerCase().includes(s)||t.invoice_id?.toLowerCase().includes(s)||(cName(t.user_id)||'').toLowerCase().includes(s));
  document.getElementById('txn-chip').textContent=`${allTxns.length} total`;
  document.getElementById('txn-table').innerHTML=list.map(t=>`
    <tr>
      <td class="tid">${t.reference||t.id}</td>
      <td><div style="font-weight:600;font-size:12px">${cName(t.user_id)}</div><div style="font-size:10px;color:var(--slate)">${cMid(t.user_id)}</div></td>
      <td style="color:var(--sky);font-weight:600;font-size:12px">${t.invoice_id||'â€”'}</td>
      <td style="font-weight:700;color:var(--navy)">US$${(t.amount||0).toFixed(2)}</td>
      <td style="font-size:12px;color:var(--slate)">${t.method||'â€”'}</td>
      <td><span class="badge b-paid">âœ“ Completed</span></td>
      <td style="font-size:11px;color:var(--slate)">${(t.created_at||'').slice(0,10)}</td>
    </tr>`).join('')||`<tr><td colspan="7" style="text-align:center;padding:36px;color:var(--slate)">No transactions yet</td></tr>`;
}

/* â•â•â• ANNOUNCEMENTS â•â•â• */
function renderAnns(){
  const el=document.getElementById('ann-list');
  const ov=document.getElementById('ov-anns');
  const typeStyles={info:{bg:'rgba(26,86,219,.05)',bd:'rgba(26,86,219,.18)',ic:'â„¹ï¸',tc:'#1e40af'},warn:{bg:'rgba(245,158,11,.05)',bd:'rgba(245,158,11,.22)',ic:'âš ï¸',tc:'#b45309'},success:{bg:'rgba(16,185,129,.05)',bd:'rgba(16,185,129,.22)',ic:'âœ…',tc:'#065f46'},danger:{bg:'rgba(239,68,68,.05)',bd:'rgba(239,68,68,.2)',ic:'ğŸš¨',tc:'#b91c1c'}};
  const card=(a)=>{const t=typeStyles[a.type]||typeStyles.info;return`
    <div style="background:${t.bg};border:1px solid ${t.bd};border-radius:var(--rlg);padding:18px;margin-bottom:12px;position:relative">
      ${a.pinned?'<span style="position:absolute;top:12px;right:14px;font-size:11px;color:var(--slate)">ğŸ“Œ Pinned</span>':''}
      <div style="display:inline-flex;align-items:center;gap:5px;background:${t.bg};border:1px solid ${t.bd};border-radius:20px;padding:3px 10px;font-size:10px;font-weight:700;color:${t.tc};margin-bottom:10px">${t.ic} ${a.type.toUpperCase()}</div>
      <div style="font-family:var(--fh);font-size:15px;font-weight:700;color:var(--navy);margin-bottom:6px">${a.title}</div>
      <div style="font-size:13px;color:var(--slate);line-height:1.7">${a.message}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-size:11px;color:var(--slate)">
        <span>Posted: ${(a.created_at||'').slice(0,10)} Â· Target: ${a.target||'all'}</span>
        <button class="btn btn-danger btn-sm" onclick="deleteAnn('${a.id}')">Delete</button>
      </div>
    </div>`;};
  if(el) el.innerHTML=allAnns.map(card).join('')||'<p style="color:var(--slate);font-size:13px">No announcements yet.</p>';
  if(ov) ov.innerHTML=allAnns.slice(0,3).map(card).join('')||'<p style="color:var(--slate);font-size:13px">No active announcements.</p>';
}
async function postAnnouncement(){await _postAnn('ann-title','ann-msg','ann-type','ann-exp','ann-pinned','ann-target');}
async function postAnnModal(){await _postAnn('m-ann-title','m-ann-msg','m-ann-type','m-ann-exp','m-ann-pin','ann-target');}
async function _postAnn(ti,mi,ty,ex,pi,tg){
  const title=document.getElementById(ti).value.trim();
  const message=document.getElementById(mi).value.trim();
  if(!title||!message){showToast('err','Title and message required.');return;}
  const ann={id:'ann-'+Date.now(),title,message,type:document.getElementById(ty).value,expires:document.getElementById(ex)?.value||null,pinned:document.getElementById(pi)?.checked||false,target:document.getElementById(tg)?.value||'all',active:true,created_at:new Date().toISOString()};
  if(sb){const {error}=await sb.from('announcements').insert(ann);if(error){showToast('err',error.message);return;}await loadAll();}
  else{allAnns.unshift(ann);renderAnns();}
  closeMod('ann-modal');showToast('ok','ğŸ“¢ Announcement posted!');
  document.getElementById(ti).value=''; document.getElementById(mi).value='';
}
async function deleteAnn(id){
  if(sb){await sb.from('announcements').delete().eq('id',id);await loadAll();}
  else{allAnns=allAnns.filter(a=>a.id!==id);renderAnns();}
  showToast('ok','ğŸ—‘ï¸ Announcement deleted.');
}

/* â•â•â• BRANCHES â•â•â• */
function renderBranches(){
  document.getElementById('branch-table').innerHTML=allBranches.map(b=>`
    <tr>
      <td style="font-weight:600">${b.name}</td>
      <td style="font-size:12px;color:var(--slate)">${b.address}</td>
      <td style="font-size:12px">${b.phone}</td>
      <td style="font-size:12px;color:var(--slate)">${b.hours}</td>
      <td style="font-size:12px">${b.manager}</td>
      <td><span class="badge ${b.active?'b-rd':'b-un'}">${b.active?'âœ… Active':'â¸ Inactive'}</span></td>
      <td><button class="btn btn-g btn-sm" onclick="showToast('info','Branch editing coming soon')">Edit</button></td>
    </tr>`).join('')||`<tr><td colspan="7" style="text-align:center;padding:36px;color:var(--slate)">No branches found</td></tr>`;
}

/* â•â•â• RATES â•â•â• */
function saveRates(){showToast('ok','ğŸ’¾ Rates saved! (Update Supabase config table to persist)');}

/* â•â•â• SETTINGS â•â•â• */
async function testConnection(){
  const url=document.getElementById('cfg-url').value.trim(), key=document.getElementById('cfg-key').value.trim();
  if(!url||!key){showToast('err','Enter URL and key first.');return;}
  try{
    const test=window.supabase.createClient(url,key);
    const {error}=await test.from('profiles').select('id').limit(1);
    if(error) showToast('err','Connection failed: '+error.message);
    else showToast('ok','âœ… Supabase connected successfully!');
  }catch(e){showToast('err','Invalid credentials.');}
}
async function saveAdminProfile(){
  const name=document.getElementById('cfg-name').value.trim(), pass=document.getElementById('cfg-pass').value;
  if(sb&&pass&&pass.length>=8){await sb.auth.updateUser({password:pass});}
  showToast('ok','ğŸ’¾ Profile saved!');
}

/* â•â•â• TAB SWITCHING â•â•â• */
const TAB_TITLES={overview:'Dashboard Overview',analytics:'Analytics',packages:'Package Management',customers:'Customer Accounts',prealerts:'Pre-Alert Management',transactions:'Transaction History',announcements:'Announcements',rates:'Rates & Fees',branches:'Branch Locations',settings:'System Settings'};
function goTab(name){
  document.querySelectorAll('[id^="t-"]').forEach(t=>t.classList.add('hidden'));
  const el=document.getElementById('t-'+name); if(el) el.classList.remove('hidden');
  document.querySelectorAll('.ni').forEach(i=>i.classList.remove('active'));
  document.querySelectorAll('.ni').forEach(i=>{if(i.getAttribute('onclick')?.includes(`'${name}'`)) i.classList.add('active');});
  document.getElementById('tbTitle').textContent=TAB_TITLES[name]||name;
  window.scrollTo({top:0,behavior:'smooth'});
  if(name==='analytics') updateAnalytics();
}

/* â•â•â• MODAL â•â•â• */
function openMod(id){document.getElementById(id).classList.add('open');document.body.style.overflow='hidden';}
function closeMod(id){document.getElementById(id).classList.remove('open');document.body.style.overflow='';}
document.querySelectorAll('.mo').forEach(o=>o.addEventListener('click',e=>{if(e.target===o) closeMod(o.id);}));

/* â•â•â• TOAST â•â•â• */
function showToast(type,msg){
  const tc=document.getElementById('toast-ct');
  const t=document.createElement('div');
  const icons={ok:'âœ…',err:'âŒ',info:'â„¹ï¸',warn:'âš ï¸'};
  t.className=`toast ${type}`;
  t.innerHTML=`<span style="font-size:16px">${icons[type]||'â„¹ï¸'}</span><span>${msg}</span>`;
  tc.appendChild(t);
  setTimeout(()=>{t.style.animation='toastIn .33s reverse both';setTimeout(()=>t.remove(),340);},4200);
}

/* â•â•â• AUTH â•â•â• */
async function doSignOut(){if(sb) await sb.auth.signOut(); window.location.href='islandship-part1-landing-auth.html';}
function goHome(){window.location.href='islandship-part1-landing-auth.html';}
function goCustomerDash(){window.location.href='islandship-part2-customer-dashboard.html';}

/* â•â•â• BUBBLES â•â•â• */
(()=>{const w=document.getElementById('bubs');for(let i=0;i<16;i++){const b=document.createElement('div');b.className='bub';const s=3+Math.random()*7;b.style.cssText=`width:${s}px;height:${s}px;left:${Math.random()*100}%;--d:${8+Math.random()*10}s;--dl:${Math.random()*12}s`;w.appendChild(b);}})();
</script>
</body>
</html>
