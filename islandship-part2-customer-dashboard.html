<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>IslandShip ‚Äî My Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ‚ïê‚ïê‚ïê TOKENS ‚ïê‚ïê‚ïê */
:root {
  --navy:#0a1628; --navy2:#0d1f3c; --navy3:#132952;
  --blue:#1a56db; --blue2:#1e40af; --blue-light:#3b82f6;
  --sky:#0ea5e9; --ice:#e0f2fe; --white:#ffffff;
  --off:#f8faff; --mist:#f0f6ff; --silver:#cbd5e1;
  --slate:#64748b; --mid:#334155;
  --gold:#f59e0b; --gold2:#d97706;
  --success:#10b981; --danger:#ef4444; --warn:#f97316;
  --font-head:'Syne',sans-serif; --font-body:'DM Sans',sans-serif;
  --r-sm:8px; --r-md:14px; --r-lg:22px; --r-xl:32px;
  --sh-sm:0 2px 8px rgba(26,86,219,.08);
  --sh-md:0 8px 32px rgba(26,86,219,.12);
  --sh-lg:0 24px 64px rgba(10,22,40,.18);
  --trans:all .28s cubic-bezier(.23,1,.32,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:16px;scroll-behavior:smooth}
body{font-family:var(--font-body);background:var(--off);color:var(--navy);overflow-x:hidden}
input,select,textarea,button{font-family:var(--font-body)}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:var(--blue-light);border-radius:3px}

/* ‚ïê‚ïê‚ïê KEYFRAMES ‚ïê‚ïê‚ïê */
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(26,86,219,.4)}50%{box-shadow:0 0 0 10px rgba(26,86,219,0)}}
@keyframes shimmer{0%{background-position:-200% center}100%{background-position:200% center}}
@keyframes slideRight{from{opacity:0;transform:translateX(-18px)}to{opacity:1;transform:translateX(0)}}
@keyframes countUp{from{opacity:0;transform:scale(.6)}to{opacity:1;transform:scale(1)}}
@keyframes bobFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes waveFlow{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
@keyframes shipSail{0%{transform:translateX(-180px);opacity:0}5%{opacity:1}95%{opacity:1}100%{transform:translateX(110vw);opacity:0}}
@keyframes planeFly{0%{transform:translateX(-140px) translateY(8px) rotate(-3deg);opacity:0}6%{opacity:1}95%{opacity:1}100%{transform:translateX(110vw) translateY(-20px) rotate(1deg);opacity:0}}
@keyframes cloudDrift{0%{transform:translateX(-200px);opacity:0}8%{opacity:.7}92%{opacity:.7}100%{transform:translateX(110vw);opacity:0}}
@keyframes toastIn{from{opacity:0;transform:translateX(120%)}to{opacity:1;transform:translateX(0)}}
@keyframes tabUnderline{from{width:0}to{width:100%}}
@keyframes progressFill{from{width:0}to{width:var(--w)}}
@keyframes bubbleUp{0%{transform:translateY(0) scale(1);opacity:.4}100%{transform:translateY(-80vh) scale(.2);opacity:0}}

/* ‚ïê‚ïê‚ïê SCENE (mini animated bg) ‚ïê‚ïê‚ïê */
#scene{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.scene-bg{position:absolute;inset:0;background:linear-gradient(175deg,#e8f4ff 0%,#f8faff 55%,#eef6ff 100%)}
.scene-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(26,86,219,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(26,86,219,.03) 1px,transparent 1px);background-size:70px 70px}
.blob{position:absolute;border-radius:50%;filter:blur(90px);opacity:.28}
.s-plane{position:absolute;top:6%;animation:planeFly 30s 4s linear infinite}
.s-plane2{position:absolute;top:2%;animation:planeFly 46s 22s linear infinite;opacity:.5}
.s-ship{position:absolute;bottom:8%;animation:shipSail 52s 8s linear infinite}
.s-ship2{position:absolute;bottom:4%;animation:shipSail 74s 36s linear infinite;opacity:.55}
.s-cloud{position:absolute;animation:cloudDrift linear infinite}
.ocean-wrap{position:absolute;bottom:0;left:0;right:0;height:130px;overflow:hidden}
.wave-t{position:absolute;bottom:0;width:200%}
.wave-t1{animation:waveFlow 12s linear infinite}
.wave-t2{animation:waveFlow 18s linear infinite reverse;bottom:8px;opacity:.6}
.bubble-bg{position:absolute;bottom:0;border-radius:50%;background:rgba(59,130,246,.13);border:1px solid rgba(59,130,246,.22);animation:bubbleUp var(--d) var(--dl) infinite ease-in}

/* ‚ïê‚ïê‚ïê LAYOUT ‚ïê‚ïê‚ïê */
#app{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column}

/* ‚ïê‚ïê‚ïê SIDEBAR NAV ‚ïê‚ïê‚ïê */
.sidebar{
  position:fixed;top:0;left:0;bottom:0;width:260px;
  background:var(--navy);
  display:flex;flex-direction:column;
  z-index:200;
  box-shadow:4px 0 32px rgba(10,22,40,.18);
}
.sidebar-logo{
  padding:28px 24px 22px;
  display:flex;align-items:center;gap:12px;
  border-bottom:1px solid rgba(255,255,255,.07);
}
.sidebar-logo-icon{
  width:40px;height:40px;border-radius:11px;
  background:linear-gradient(135deg,var(--blue),var(--sky));
  display:flex;align-items:center;justify-content:center;font-size:19px;
  box-shadow:0 4px 14px rgba(26,86,219,.4);flex-shrink:0;
}
.sidebar-logo-text{font-family:var(--font-head);font-size:20px;font-weight:800;color:#fff}
.sidebar-logo-text span{background:linear-gradient(135deg,var(--sky),#38bdf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sidebar-user{
  padding:18px 24px;
  background:rgba(255,255,255,.04);
  margin:12px;border-radius:var(--r-md);
  border:1px solid rgba(255,255,255,.07);
}
.sidebar-user-avatar{
  width:44px;height:44px;border-radius:50%;
  background:linear-gradient(135deg,var(--blue),var(--sky));
  display:flex;align-items:center;justify-content:center;
  font-size:18px;font-weight:700;color:#fff;
  margin-bottom:10px;flex-shrink:0;
  box-shadow:0 4px 14px rgba(26,86,219,.35);
}
.sidebar-user-name{font-weight:700;font-size:14px;color:#fff;margin-bottom:2px}
.sidebar-user-id{font-size:12px;color:rgba(255,255,255,.4)}
.sidebar-member-badge{
  display:inline-block;margin-top:8px;
  background:rgba(26,86,219,.25);border:1px solid rgba(26,86,219,.4);
  color:var(--sky);font-size:10px;font-weight:700;letter-spacing:1px;
  padding:3px 10px;border-radius:20px;
}
.sidebar-nav{flex:1;padding:8px 12px;overflow-y:auto}
.nav-group-label{
  font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;
  color:rgba(255,255,255,.28);padding:14px 12px 6px;
}
.nav-item{
  display:flex;align-items:center;gap:12px;
  padding:11px 14px;border-radius:var(--r-sm);
  cursor:pointer;margin-bottom:2px;
  font-size:14px;font-weight:500;color:rgba(255,255,255,.55);
  transition:var(--trans);position:relative;
}
.nav-item:hover{color:#fff;background:rgba(255,255,255,.07)}
.nav-item.active{
  color:#fff;
  background:linear-gradient(135deg,rgba(26,86,219,.35),rgba(14,165,233,.2));
  border:1px solid rgba(26,86,219,.35);
}
.nav-item.active::before{
  content:'';position:absolute;left:0;top:25%;bottom:25%;
  width:3px;border-radius:0 3px 3px 0;
  background:linear-gradient(180deg,var(--blue),var(--sky));
}
.nav-item-icon{font-size:17px;width:22px;text-align:center;flex-shrink:0}
.nav-badge{
  margin-left:auto;background:var(--danger);color:#fff;
  font-size:10px;font-weight:700;min-width:18px;height:18px;
  border-radius:9px;display:flex;align-items:center;justify-content:center;
  padding:0 5px;
}
.sidebar-footer{
  padding:16px 12px;border-top:1px solid rgba(255,255,255,.07);
}
.sidebar-footer .nav-item{color:rgba(255,255,255,.4)}
.sidebar-footer .nav-item:hover{color:var(--danger);background:rgba(239,68,68,.07)}

/* ‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê */
.main{margin-left:260px;min-height:100vh;display:flex;flex-direction:column}
.topbar{
  height:68px;background:rgba(248,250,255,.92);backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(26,86,219,.08);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 36px;
  position:sticky;top:0;z-index:100;
  box-shadow:0 2px 16px rgba(10,22,40,.05);
}
.topbar-title{font-family:var(--font-head);font-size:20px;font-weight:700;color:var(--navy)}
.topbar-actions{display:flex;align-items:center;gap:12px}
.topbar-notif{
  position:relative;width:38px;height:38px;border-radius:var(--r-sm);
  background:rgba(26,86,219,.07);border:1px solid rgba(26,86,219,.12);
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  font-size:18px;transition:var(--trans);
}
.topbar-notif:hover{background:rgba(26,86,219,.12)}
.notif-dot{
  position:absolute;top:6px;right:6px;width:8px;height:8px;
  border-radius:50%;background:var(--danger);border:2px solid var(--off);
}
.page-content{flex:1;padding:32px 36px;max-width:1200px;width:100%}

/* ‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê */
.tab-bar{
  display:flex;gap:4px;background:rgba(255,255,255,.8);
  border:1px solid rgba(26,86,219,.1);
  border-radius:var(--r-md);padding:5px;
  margin-bottom:28px;flex-wrap:wrap;
  box-shadow:var(--sh-sm);
  backdrop-filter:blur(10px);
}
.tab{
  padding:9px 18px;border-radius:var(--r-sm);
  font-size:13px;font-weight:600;cursor:pointer;
  color:var(--slate);transition:var(--trans);
  display:flex;align-items:center;gap:6px;
  white-space:nowrap;
}
.tab:hover{color:var(--blue);background:rgba(26,86,219,.06)}
.tab.active{
  background:linear-gradient(135deg,var(--blue),var(--sky));
  color:#fff;
  box-shadow:0 4px 14px rgba(26,86,219,.28);
}

/* ‚ïê‚ïê‚ïê CARDS ‚ïê‚ïê‚ïê */
.card{
  background:rgba(255,255,255,.92);backdrop-filter:blur(16px);
  border:1px solid rgba(26,86,219,.08);
  border-radius:var(--r-lg);padding:28px;
  box-shadow:var(--sh-sm);
  transition:var(--trans);
}
.card:hover{box-shadow:var(--sh-md)}
.card-3d{transform-style:preserve-3d;transition:var(--trans)}
.card-3d:hover{transform:perspective(1000px) rotateX(-2deg) rotateY(3deg) translateZ(8px);box-shadow:0 20px 48px rgba(26,86,219,.14)}

/* ‚ïê‚ïê‚ïê STAT CARDS ‚ïê‚ïê‚ïê */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:16px;margin-bottom:28px}
.stat-card{
  background:#fff;border-radius:var(--r-lg);padding:22px 20px;
  border:1px solid rgba(26,86,219,.08);
  box-shadow:var(--sh-sm);
  position:relative;overflow:hidden;
  transition:var(--trans);animation:fadeUp .5s var(--d,0s) ease both;
}
.stat-card:hover{transform:translateY(-4px);box-shadow:var(--sh-md)}
.stat-card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:3px;
  background:var(--bar,linear-gradient(90deg,var(--blue),var(--sky)));
}
.stat-icon{font-size:28px;margin-bottom:12px}
.stat-val{
  font-family:var(--font-head);font-size:34px;font-weight:800;
  background:var(--grad,linear-gradient(135deg,var(--blue),var(--sky)));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:countUp .5s ease both;line-height:1;
}
.stat-lbl{font-size:12px;color:var(--slate);font-weight:500;margin-top:4px}

/* ‚ïê‚ïê‚ïê TABLE ‚ïê‚ïê‚ïê */
.table-wrap{overflow-x:auto;border-radius:var(--r-md)}
table{width:100%;border-collapse:collapse;font-size:14px}
thead th{
  text-align:left;padding:10px 14px;
  font-size:10px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;
  color:var(--slate);background:var(--mist);
  border-bottom:2px solid rgba(26,86,219,.1);white-space:nowrap;
}
tbody tr{border-bottom:1px solid rgba(26,86,219,.05);transition:var(--trans)}
tbody tr:hover{background:rgba(26,86,219,.025)}
tbody td{padding:14px 14px;color:var(--mid);vertical-align:middle}
.td-id{color:var(--blue);font-weight:700;font-size:12px;font-family:var(--font-head);white-space:nowrap}
.td-link{color:var(--sky);cursor:pointer;font-weight:600;font-size:13px}
.td-link:hover{text-decoration:underline}

/* ‚ïê‚ïê‚ïê BADGE ‚ïê‚ïê‚ïê */
.badge{
  display:inline-flex;align-items:center;gap:5px;
  border-radius:40px;padding:4px 12px;font-size:11px;font-weight:700;
  white-space:nowrap;
}
.badge-warehouse{background:rgba(245,158,11,.1);color:#b45309;border:1px solid rgba(245,158,11,.25)}
.badge-transit{background:rgba(14,165,233,.1);color:#0369a1;border:1px solid rgba(14,165,233,.25)}
.badge-customs{background:rgba(249,115,22,.1);color:#c2410c;border:1px solid rgba(249,115,22,.25)}
.badge-ready{background:rgba(16,185,129,.1);color:#065f46;border:1px solid rgba(16,185,129,.25)}
.badge-delivered{background:rgba(100,116,139,.1);color:var(--slate);border:1px solid rgba(100,116,139,.2)}
.badge-paid{background:rgba(16,185,129,.1);color:#065f46;border:1px solid rgba(16,185,129,.25)}
.badge-unpaid{background:rgba(239,68,68,.08);color:#b91c1c;border:1px solid rgba(239,68,68,.2)}

/* ‚ïê‚ïê‚ïê ADDRESS CARD ‚ïê‚ïê‚ïê */
.address-card{
  background:linear-gradient(135deg,var(--navy) 0%,var(--navy2) 60%,var(--navy3) 100%);
  border-radius:var(--r-lg);padding:32px;
  position:relative;overflow:hidden;margin-bottom:28px;
}
.address-card::before{
  content:'';position:absolute;top:-80px;right:-80px;
  width:260px;height:260px;border-radius:50%;
  background:radial-gradient(circle,rgba(26,86,219,.3),transparent);
}
.address-card::after{
  content:'';position:absolute;bottom:-60px;left:-60px;
  width:200px;height:200px;border-radius:50%;
  background:radial-gradient(circle,rgba(14,165,233,.2),transparent);
}
.address-label{
  font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;
  color:rgba(255,255,255,.5);margin-bottom:8px;position:relative;z-index:1;
}
.address-text{
  font-family:var(--font-head);font-size:clamp(13px,2vw,17px);font-weight:600;
  color:#fff;margin-bottom:14px;position:relative;z-index:1;line-height:1.6;
}
.address-actions{display:flex;gap:10px;flex-wrap:wrap;position:relative;z-index:1}

/* ‚ïê‚ïê‚ïê BUTTONS ‚ïê‚ïê‚ïê */
.btn{
  border:none;border-radius:var(--r-md);font-weight:600;cursor:pointer;
  transition:var(--trans);display:inline-flex;align-items:center;justify-content:center;gap:7px;
}
.btn:hover{transform:translateY(-2px) scale(1.015)}
.btn:active{transform:translateY(0) scale(.98)}
.btn-primary{background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;padding:10px 22px;font-size:14px;box-shadow:0 4px 16px rgba(26,86,219,.32)}
.btn-primary:hover{box-shadow:0 8px 28px rgba(26,86,219,.44)}
.btn-outline{background:transparent;color:var(--blue);border:1.5px solid rgba(26,86,219,.28);padding:9px 20px;font-size:14px}
.btn-outline:hover{border-color:var(--blue);background:rgba(26,86,219,.04)}
.btn-ghost{background:rgba(26,86,219,.07);color:var(--blue);padding:9px 20px;font-size:14px}
.btn-white{background:#fff;color:var(--navy);padding:9px 18px;font-size:13px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.btn-sm{padding:6px 15px;font-size:12px}
.btn-lg{padding:13px 32px;font-size:15px}
.btn-full{width:100%}
.btn-success{background:linear-gradient(135deg,var(--success),#059669);color:#fff;padding:10px 22px;font-size:14px;box-shadow:0 4px 16px rgba(16,185,129,.28)}
.btn-danger{background:linear-gradient(135deg,var(--danger),#dc2626);color:#fff;padding:10px 22px;font-size:14px}
.btn-disabled{opacity:.5;cursor:not-allowed;pointer-events:none}

/* ‚ïê‚ïê‚ïê FORM ‚ïê‚ïê‚ïê */
.field{margin-bottom:18px}
.field label{display:block;font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--slate);margin-bottom:7px}
.field input,.field select,.field textarea{
  width:100%;padding:12px 16px;border-radius:var(--r-sm);
  border:1.5px solid #e2e8f0;background:#f8faff;
  color:var(--navy);font-size:14px;font-family:var(--font-body);
  outline:none;transition:var(--trans);
}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--blue);background:#fff;box-shadow:0 0 0 4px rgba(26,86,219,.08)}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.field-row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
.modal-overlay{
  position:fixed;inset:0;z-index:800;
  background:rgba(10,22,40,.55);backdrop-filter:blur(16px);
  display:flex;align-items:center;justify-content:center;padding:20px;
  opacity:0;pointer-events:none;transition:opacity .28s ease;
}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{
  background:#fff;border-radius:var(--r-xl);padding:0;
  width:100%;max-width:640px;max-height:90vh;overflow-y:auto;
  box-shadow:0 40px 100px rgba(10,22,40,.2);
  transform:translateY(20px) scale(.97);
  transition:transform .32s cubic-bezier(.23,1,.32,1);
}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal-lg{max-width:820px}
.modal-head{
  background:linear-gradient(135deg,var(--navy),var(--navy2));
  padding:28px 32px;border-radius:var(--r-xl) var(--r-xl) 0 0;
  position:relative;overflow:hidden;
}
.modal-head::before{content:'';position:absolute;top:-50px;right:-50px;width:180px;height:180px;border-radius:50%;background:radial-gradient(circle,rgba(26,86,219,.2),transparent)}
.modal-head h3{font-family:var(--font-head);font-size:22px;font-weight:700;color:#fff;position:relative;z-index:1}
.modal-head p{font-size:13px;color:rgba(255,255,255,.5);margin-top:4px;position:relative;z-index:1}
.modal-close{position:absolute;top:16px;right:16px;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.1);color:#fff;font-size:19px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;font-family:var(--font-body);transition:var(--trans);z-index:2}
.modal-close:hover{background:rgba(255,255,255,.18)}
.modal-body{padding:28px 32px}

/* ‚ïê‚ïê‚ïê PROGRESS BAR ‚ïê‚ïê‚ïê */
.progress-wrap{position:relative;margin-bottom:8px}
.progress-track{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden}
.progress-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--blue),var(--sky));width:var(--w,0%);animation:progressFill .8s .3s ease both}
.progress-pct{font-size:12px;color:var(--blue);font-weight:600;text-align:right;margin-top:4px}

/* ‚ïê‚ïê‚ïê STEP TRACKER ‚ïê‚ïê‚ïê */
.steps-track{display:flex;position:relative;padding-bottom:8px;justify-content:space-between}
.steps-track::before{
  content:'';position:absolute;top:18px;left:5%;right:5%;height:3px;
  background:linear-gradient(90deg,var(--blue) var(--pct,0%),#e2e8f0 var(--pct,0%));
  border-radius:2px;z-index:0;
}
.step-node{display:flex;flex-direction:column;align-items:center;gap:8px;flex:1;z-index:1;position:relative}
.step-dot{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;transition:var(--trans)}
.step-dot.done{background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;box-shadow:0 4px 12px rgba(26,86,219,.35)}
.step-dot.current{background:#fff;color:var(--blue);border:2.5px solid var(--blue);box-shadow:0 0 0 5px rgba(26,86,219,.1),0 4px 12px rgba(26,86,219,.2);animation:pulse 2s infinite}
.step-dot.pending{background:#f1f5f9;color:#cbd5e1;border:2px solid #e2e8f0}
.step-lbl{font-size:10px;font-weight:600;text-align:center;line-height:1.4;color:var(--slate);max-width:70px}
.step-lbl.done,.step-lbl.current{color:var(--blue)}

/* ‚ïê‚ïê‚ïê INVOICE ‚ïê‚ïê‚ïê */
.invoice-wrap{background:#fff;border-radius:var(--r-lg);padding:36px;color:#111}
.invoice-logo{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.invoice-logo .icon{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--blue),var(--sky));display:flex;align-items:center;justify-content:center;font-size:17px}
.invoice-logo .name{font-family:var(--font-head);font-size:21px;font-weight:800;color:var(--navy)}
.inv-table{width:100%;border-collapse:collapse;margin-bottom:18px}
.inv-table th{background:#f8faff;padding:10px 14px;font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--slate);font-weight:700;text-align:left;border-bottom:2px solid #e2e8f0}
.inv-table td{padding:13px 14px;font-size:14px;border-bottom:1px solid #f1f5f9}
.inv-total-row td{font-weight:700;font-size:15px;background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;padding:14px}

/* ‚ïê‚ïê‚ïê ALERT / NOTICE ‚ïê‚ïê‚ïê */
.alert{border-radius:var(--r-md);padding:13px 17px;font-size:14px;margin-bottom:18px;display:flex;align-items:flex-start;gap:10px}
.alert-warn{background:rgba(249,115,22,.07);border:1px solid rgba(249,115,22,.22);color:#c2410c}
.alert-info{background:rgba(26,86,219,.06);border:1px solid rgba(26,86,219,.18);color:var(--blue2)}
.alert-success{background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.22);color:#065f46}
.alert-danger{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.2);color:#b91c1c}

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
#toast-container{position:fixed;top:22px;right:22px;z-index:9999;display:flex;flex-direction:column;gap:10px}
.toast{display:flex;align-items:center;gap:12px;background:#fff;border-radius:var(--r-md);padding:13px 17px;box-shadow:0 8px 32px rgba(10,22,40,.15);border-left:4px solid var(--blue);min-width:270px;max-width:360px;animation:toastIn .35s cubic-bezier(.23,1,.32,1) both;font-size:14px;color:var(--navy)}
.toast.success{border-color:var(--success)}
.toast.error{border-color:var(--danger)}
.toast.warn{border-color:var(--gold)}

/* ‚ïê‚ïê‚ïê SPINNER ‚ïê‚ïê‚ïê */
.spinner{width:17px;height:17px;border-radius:50%;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;animation:spin .75s linear infinite;flex-shrink:0}
.spinner-blue{border:2px solid rgba(26,86,219,.2);border-top-color:var(--blue)}

/* ‚ïê‚ïê‚ïê EMPTY STATE ‚ïê‚ïê‚ïê */
.empty{text-align:center;padding:56px 20px;color:var(--slate)}
.empty-icon{font-size:52px;margin-bottom:16px}
.empty h4{font-family:var(--font-head);font-size:20px;color:var(--navy);margin-bottom:8px}
.empty p{font-size:14px;line-height:1.7;max-width:360px;margin:0 auto 20px}

/* ‚ïê‚ïê‚ïê PAYMENT METHODS ‚ïê‚ïê‚ïê */
.pay-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.pay-opt{
  border-radius:var(--r-md);padding:14px 16px;cursor:pointer;
  border:2px solid #e2e8f0;background:#fff;
  transition:var(--trans);display:flex;align-items:center;gap:10px;
}
.pay-opt:hover{border-color:var(--blue-light);background:rgba(26,86,219,.02)}
.pay-opt.selected{border-color:var(--blue);background:rgba(26,86,219,.04);box-shadow:0 0 0 3px rgba(26,86,219,.1)}
.pay-opt-icon{font-size:22px;flex-shrink:0}
.pay-opt-name{font-weight:600;font-size:14px;color:var(--navy)}
.pay-opt-sub{font-size:12px;color:var(--slate)}

/* ‚ïê‚ïê‚ïê MISC ‚ïê‚ïê‚ïê */
.hidden{display:none!important}
.text-center{text-align:center}
.text-blue{color:var(--blue)}
.text-slate{color:var(--slate)}
.chip{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;background:rgba(26,86,219,.08);color:var(--blue);border:1px solid rgba(26,86,219,.14)}
.section-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}
.section-title{font-family:var(--font-head);font-size:19px;font-weight:700;color:var(--navy)}
.divider-h{height:1px;background:rgba(26,86,219,.08);margin:22px 0}

/* ‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê */
@media(max-width:900px){
  .sidebar{width:220px}
  .main{margin-left:220px}
  .page-content{padding:22px}
}
@media(max-width:680px){
  .sidebar{transform:translateX(-100%);width:260px;transition:var(--trans)}
  .sidebar.open{transform:translateX(0)}
  .main{margin-left:0}
  .topbar{padding:0 18px}
  .page-content{padding:18px}
  .field-row,.field-row3{grid-template-columns:1fr}
  .rates-grid,.pay-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê SCENE ‚ïê‚ïê‚ïê -->
<div id="scene">
  <div class="scene-bg"></div>
  <div class="scene-grid"></div>
  <div class="blob" style="width:500px;height:500px;background:radial-gradient(circle,rgba(26,86,219,.12),transparent);top:-100px;right:-50px"></div>
  <div class="blob" style="width:300px;height:300px;background:radial-gradient(circle,rgba(14,165,233,.1),transparent);bottom:80px;left:-80px"></div>

  <!-- Plane -->
  <div class="s-plane">
    <svg width="90" height="44" viewBox="0 0 220 104" fill="none">
      <defs><linearGradient id="pf" x1="0" y1=".5" x2="1" y2=".5"><stop offset="0%" stop-color="#1a56db"/><stop offset="60%" stop-color="#0ea5e9"/></linearGradient></defs>
      <path d="M18 50 Q42 42 105 47 Q158 47 195 52 Q205 52 205 56 Q205 60 195 61 Q158 66 105 61 Q42 66 18 58 Z" fill="url(#pf)"/>
      <path d="M195 52 L212 56 L195 61 Z" fill="#e0f2fe"/>
      <path d="M72 48 L92 14 L150 47 Z" fill="#1e40af"/>
      <path d="M72 60 L92 94 L150 61 Z" fill="#1e40af" opacity=".8"/>
    </svg>
  </div>
  <div class="s-plane2">
    <svg width="58" height="28" viewBox="0 0 220 104" fill="none">
      <path d="M18 50 Q42 42 105 47 Q158 47 195 52 Q205 52 205 56 Q205 60 195 61 Q158 66 105 61 Q42 66 18 58 Z" fill="#1a56db"/>
      <path d="M72 48 L92 14 L150 47 Z" fill="#1e40af"/>
      <path d="M72 60 L92 94 L150 61 Z" fill="#1e40af" opacity=".8"/>
    </svg>
  </div>

  <!-- Ship -->
  <div class="s-ship">
    <svg width="120" height="78" viewBox="0 0 240 155" fill="none" style="filter:drop-shadow(0 6px 18px rgba(26,86,219,.25))">
      <defs><linearGradient id="sh" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#1a56db"/><stop offset="100%" stop-color="#1e3a8a"/></linearGradient></defs>
      <path d="M30 98 L210 98 L192 128 L48 128 Z" fill="url(#sh)"/>
      <path d="M30 98 L42 80 L198 80 L210 98 Z" fill="#1e40af"/>
      <rect x="72" y="50" width="96" height="32" rx="6" fill="#dbeafe"/>
      <rect x="88" y="34" width="64" height="18" rx="4" fill="#dbeafe"/>
      <rect x="108" y="8" width="8" height="28" rx="2" fill="#1a56db"/>
      <path d="M108 8 L122 13 L108 18 Z" fill="#3b82f6"/>
    </svg>
  </div>
  <div class="s-ship2">
    <svg width="72" height="46" viewBox="0 0 240 155" fill="none">
      <path d="M30 98 L210 98 L192 128 L48 128 Z" fill="#1e3a8a"/>
      <path d="M30 98 L42 80 L198 80 L210 98 Z" fill="#1e40af"/>
      <rect x="72" y="50" width="96" height="32" rx="6" fill="#bfdbfe"/>
    </svg>
  </div>

  <!-- Clouds -->
  <div class="s-cloud" style="top:5%;animation-duration:44s;animation-delay:0s"><div style="width:90px;height:28px;border-radius:40px;background:rgba(255,255,255,.82)"></div></div>
  <div class="s-cloud" style="top:11%;animation-duration:62s;animation-delay:20s"><div style="width:130px;height:36px;border-radius:40px;background:rgba(255,255,255,.7)"></div></div>

  <!-- Ocean -->
  <div class="ocean-wrap">
    <div class="wave-t wave-t1">
      <svg width="200%" height="90" viewBox="0 0 2880 90" preserveAspectRatio="none" style="display:block">
        <path d="M0,45 C180,8 360,82 540,45 C720,8 900,82 1080,45 C1260,8 1440,82 1440,45 C1620,8 1800,82 1980,45 C2160,8 2340,82 2520,45 C2700,8 2880,82 2880,45 L2880,90 L0,90 Z" fill="rgba(26,86,219,.06)"/>
      </svg>
    </div>
    <div class="wave-t wave-t2">
      <svg width="200%" height="70" viewBox="0 0 2880 70" preserveAspectRatio="none" style="display:block">
        <path d="M0,35 C240,4 480,66 720,35 C960,4 1200,66 1440,35 C1680,4 1920,66 2160,35 C2400,4 2640,66 2880,35 L2880,70 L0,70 Z" fill="rgba(14,165,233,.04)"/>
      </svg>
    </div>
  </div>
  <div id="bubbles-bg"></div>
</div>

<!-- ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê -->
<div id="toast-container"></div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div id="app">
  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon">üáØüá≤</div>
      <div class="sidebar-logo-text">Island<span>Ship</span></div>
    </div>

    <div class="sidebar-user" id="sidebarUser">
      <div style="display:flex;align-items:center;gap:12px">
        <div class="sidebar-user-avatar" id="userAvatar">P</div>
        <div>
          <div class="sidebar-user-name" id="userName">Paul Medley</div>
          <div class="sidebar-user-id" id="userEmail">paul@email.com</div>
        </div>
      </div>
      <div class="sidebar-member-badge" id="memberId">BAL-10349</div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-group-label">Main Menu</div>
      <div class="nav-item active" onclick="switchTab('overview')">
        <span class="nav-item-icon">üìä</span> Overview
      </div>
      <div class="nav-item" onclick="switchTab('packages')">
        <span class="nav-item-icon">üì¶</span> My Packages
        <span class="nav-badge" id="pkgBadge" style="display:none">0</span>
      </div>
      <div class="nav-item" onclick="switchTab('track')">
        <span class="nav-item-icon">üîç</span> Track Package
      </div>
      <div class="nav-item" onclick="switchTab('prealert')">
        <span class="nav-item-icon">üì¨</span> Pre-Alert
      </div>
      <div class="nav-item" onclick="switchTab('rates')">
        <span class="nav-item-icon">üí∞</span> Rates & Calculator
      </div>
      <div class="nav-group-label" style="margin-top:8px">Account</div>
      <div class="nav-item" onclick="switchTab('invoices')">
        <span class="nav-item-icon">üßæ</span> Invoices
      </div>
      <div class="nav-item" onclick="switchTab('address')">
        <span class="nav-item-icon">üè†</span> My US Address
      </div>
      <div class="nav-item" onclick="switchTab('profile')">
        <span class="nav-item-icon">üë§</span> Profile
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="nav-item" onclick="goHome()">
        <span class="nav-item-icon">üåê</span> Back to Website
      </div>
      <div class="nav-item" onclick="doSignOut()">
        <span class="nav-item-icon">üö™</span> Sign Out
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div class="topbar-title" id="topbarTitle">Dashboard Overview</div>
      <div class="topbar-actions">
        <div class="topbar-notif" onclick="showToast('info','üì≠ No new notifications')">
          üîî
          <div class="notif-dot"></div>
        </div>
        <button class="btn btn-primary btn-sm" onclick="openModal('prealert-modal')">+ Pre-Alert</button>
      </div>
    </div>

    <div class="page-content">

      <!-- ‚ïê‚ïê OVERVIEW TAB ‚ïê‚ïê -->
      <div id="tab-overview">
        <!-- US Address Card -->
        <div class="address-card">
          <div class="address-label">üè† Your Free US Shipping Address</div>
          <div class="address-text" id="addressText">
            Paul Medley (BAL-10349)<br>
            2750 NW 87th Ave, Suite 100<br>
            Miami, FL 33172, USA
          </div>
          <div class="address-actions">
            <button class="btn btn-white btn-sm" onclick="copyAddress()">üìã Copy Address</button>
            <button class="btn btn-sm" style="background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.2)" onclick="switchTab('address')">View Full Guide ‚Üí</button>
          </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat-card" style="--d:.0s">
            <div class="stat-icon">üì¶</div>
            <div class="stat-val" id="statTotal">0</div>
            <div class="stat-lbl">Total Packages</div>
          </div>
          <div class="stat-card" style="--d:.06s;--grad:linear-gradient(135deg,#f59e0b,#d97706);--bar:linear-gradient(90deg,#f59e0b,#d97706)">
            <div class="stat-icon">üè≠</div>
            <div class="stat-val" id="statWarehouse">0</div>
            <div class="stat-lbl">In Warehouse</div>
          </div>
          <div class="stat-card" style="--d:.12s;--grad:linear-gradient(135deg,#0ea5e9,#38bdf8);--bar:linear-gradient(90deg,#0ea5e9,#38bdf8)">
            <div class="stat-icon">‚úàÔ∏è</div>
            <div class="stat-val" id="statTransit">0</div>
            <div class="stat-lbl">In Transit</div>
          </div>
          <div class="stat-card" style="--d:.18s;--grad:linear-gradient(135deg,#10b981,#059669);--bar:linear-gradient(90deg,#10b981,#059669)">
            <div class="stat-icon">üè†</div>
            <div class="stat-val" id="statDelivered">0</div>
            <div class="stat-lbl">Delivered</div>
          </div>
          <div class="stat-card" style="--d:.24s;--grad:linear-gradient(135deg,#ef4444,#dc2626);--bar:linear-gradient(90deg,#ef4444,#dc2626)">
            <div class="stat-icon">üí≥</div>
            <div class="stat-val" id="statUnpaid">0</div>
            <div class="stat-lbl">Unpaid Invoices</div>
          </div>
          <div class="stat-card" style="--d:.30s">
            <div class="stat-icon">üí∞</div>
            <div class="stat-val" id="statSpent">$0</div>
            <div class="stat-lbl">Total Spent</div>
          </div>
        </div>

        <!-- Unpaid alert -->
        <div id="unpaidAlert" class="alert alert-warn hidden">
          ‚ö†Ô∏è <span id="unpaidAlertText"></span>
        </div>

        <!-- Recent packages -->
        <div class="card">
          <div class="section-head">
            <div class="section-title">Recent Packages</div>
            <button class="btn btn-ghost btn-sm" onclick="switchTab('packages')">View All ‚Üí</button>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr>
                <th>Package ID</th><th>Description</th><th>Mode</th><th>Status</th><th>Cost</th><th>Action</th>
              </tr></thead>
              <tbody id="recentPkgTable"><tr><td colspan="6" class="text-center" style="padding:28px;color:var(--slate)"><div class="spinner spinner-blue" style="margin:0 auto"></div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PACKAGES TAB ‚ïê‚ïê -->
      <div id="tab-packages" class="hidden">
        <div class="section-head">
          <div class="section-title">All My Packages</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <select id="pkgFilter" onchange="renderPackages()" class="field" style="margin:0;padding:8px 14px;font-size:13px;border-radius:var(--r-sm);border:1.5px solid #e2e8f0">
              <option value="all">All Statuses</option>
              <option value="warehouse">In Warehouse</option>
              <option value="transit">In Transit</option>
              <option value="customs">At Customs</option>
              <option value="ready">Ready Pickup</option>
              <option value="delivered">Delivered</option>
            </select>
          </div>
        </div>
        <div class="card">
          <div class="table-wrap">
            <table>
              <thead><tr>
                <th>ID</th><th>Description</th><th>Weight</th><th>Mode</th><th>Store</th><th>Arrived</th><th>ETA</th><th>Status</th><th>Invoice</th><th>Payment</th>
              </tr></thead>
              <tbody id="allPkgTable"><tr><td colspan="10" class="text-center" style="padding:32px;color:var(--slate)">Loading‚Ä¶</td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê TRACK TAB ‚ïê‚ïê -->
      <div id="tab-track" class="hidden">
        <div class="card" style="max-width:720px;margin:0 auto">
          <div class="section-head"><div class="section-title">üîç Track a Package</div></div>
          <div style="display:flex;gap:10px;margin-bottom:28px">
            <input id="trackId" class="field" style="flex:1;margin:0;padding:12px 16px;border-radius:var(--r-sm);border:1.5px solid #e2e8f0;font-size:14px;outline:none;transition:var(--trans)" placeholder="Package ID or Invoice number" onkeydown="if(event.key==='Enter')doTrack()"/>
            <button class="btn btn-primary" onclick="doTrack()">Track ‚Üí</button>
          </div>
          <div id="trackResult">
            <div class="empty" style="padding:32px 0">
              <div class="empty-icon">üì¶</div>
              <p>Enter a Package ID above to see real-time status</p>
              <div style="margin-top:12px;font-size:13px;color:var(--slate)">Demo: PKG-2026-0001</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PRE-ALERT TAB ‚ïê‚ïê -->
      <div id="tab-prealert" class="hidden">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start">
          <div class="card">
            <div class="section-head"><div class="section-title">üì¨ New Pre-Alert</div></div>
            <div class="alert alert-info">‚ÑπÔ∏è Tell us about packages you've already ordered before they reach our warehouse.</div>
            <div id="paSuccess" class="alert alert-success hidden">‚úÖ Pre-alert submitted! We'll watch out for your package.</div>
            <div class="field"><label>Store / Merchant *</label><input id="paStore" placeholder="Amazon, Nike, Walmart‚Ä¶"/></div>
            <div class="field"><label>US Tracking Number</label><input id="paTracking" placeholder="1Z999AA10123456784"/></div>
            <div class="field"><label>Item Description *</label><input id="paDesc" placeholder="Nike Shoes Size 10 ‚Äî Black"/></div>
            <div class="field-row">
              <div class="field"><label>Est. Weight (lbs)</label><input id="paWeight" type="number" placeholder="2.5"/></div>
              <div class="field"><label>Shipping Mode</label>
                <select id="paMode"><option value="air">‚úàÔ∏è Air Freight</option><option value="sea">üö¢ Sea Freight</option></select>
              </div>
            </div>
            <div class="field"><label>Notes (optional)</label><textarea id="paNotes" rows="3" placeholder="Fragile, gift wrap, etc." style="resize:vertical"></textarea></div>
            <button class="btn btn-primary btn-full btn-lg" onclick="submitPreAlert()">Submit Pre-Alert</button>
          </div>
          <div>
            <div class="card" style="margin-bottom:18px">
              <div class="section-title" style="margin-bottom:16px">My Pre-Alerts</div>
              <div id="myPrealerts"><div class="empty" style="padding:18px 0"><div class="empty-icon" style="font-size:32px">üì¨</div><p style="font-size:13px">No pre-alerts yet</p></div></div>
            </div>
            <div class="card" style="background:var(--mist)">
              <div class="section-title" style="margin-bottom:12px;font-size:16px">üí° Why Pre-Alert?</div>
              <ul style="list-style:none;font-size:14px;color:var(--slate);line-height:2.2">
                <li>‚úÖ Speeds up warehouse processing</li>
                <li>‚úÖ Helps us identify your package</li>
                <li>‚úÖ Flag fragile or high-value items</li>
                <li>‚úÖ Required for insurance claims</li>
                <li>‚úÖ Track before it leaves the US</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê RATES TAB ‚ïê‚ïê -->
      <div id="tab-rates" class="hidden">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:28px">
          <!-- Air Card -->
          <div class="card card-3d" style="border-top:3px solid var(--blue);text-align:center">
            <svg width="120" height="58" viewBox="0 0 220 104" fill="none" style="animation:bobFloat 3.5s ease-in-out infinite;margin:0 auto 16px">
              <defs><linearGradient id="pf3" x1="0" y1=".5" x2="1" y2=".5"><stop stop-color="#1a56db"/><stop offset="1" stop-color="#0ea5e9"/></linearGradient></defs>
              <path d="M18 50 Q42 42 105 47 Q158 47 195 52 Q205 52 205 56 Q205 60 195 61 Q158 66 105 61 Q42 66 18 58 Z" fill="url(#pf3)"/>
              <path d="M195 52 L212 56 L195 61 Z" fill="#e0f2fe"/>
              <path d="M72 48 L92 14 L150 47 Z" fill="#1e40af"/>
              <path d="M72 60 L92 94 L150 61 Z" fill="#1e40af" opacity=".8"/>
              <circle cx="110" cy="54" r="3.5" fill="rgba(224,242,254,.9)"/>
              <circle cx="128" cy="54" r="3.5" fill="rgba(224,242,254,.9)"/>
            </svg>
            <div style="font-family:var(--font-head);font-size:17px;font-weight:700;margin-bottom:6px">‚úàÔ∏è Air Freight</div>
            <div style="font-family:var(--font-head);font-size:48px;font-weight:800;background:linear-gradient(135deg,var(--blue),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1">US$7<span style="font-size:18px;-webkit-text-fill-color:var(--slate)"> / lb</span></div>
            <div class="chip" style="margin-top:12px">üïí 5‚Äì7 Business Days</div>
            <div class="divider-h"></div>
            <ul style="text-align:left;list-style:none;font-size:14px;color:var(--slate)">
              <li style="padding:5px 0">‚úì Weekly departures</li>
              <li style="padding:5px 0">‚úì Real-time tracking</li>
              <li style="padding:5px 0">‚úì Best for small items</li>
              <li style="padding:5px 0">‚úì Door delivery available</li>
            </ul>
          </div>
          <!-- Sea Card -->
          <div class="card card-3d" style="border-top:3px solid var(--sky);text-align:center">
            <svg width="140" height="88" viewBox="0 0 240 155" fill="none" style="animation:bobFloat 5s ease-in-out infinite;margin:0 auto 16px">
              <defs><linearGradient id="sh3" x1="0" y1="0" x2="0" y2="1"><stop stop-color="#1a56db"/><stop offset="1" stop-color="#1e3a8a"/></linearGradient></defs>
              <path d="M30 98 L210 98 L192 128 L48 128 Z" fill="url(#sh3)"/>
              <path d="M30 98 L42 80 L198 80 L210 98 Z" fill="#1e40af"/>
              <rect x="72" y="50" width="96" height="32" rx="6" fill="#dbeafe"/>
              <rect x="88" y="34" width="64" height="18" rx="4" fill="#dbeafe"/>
              <rect x="108" y="8" width="8" height="28" rx="2" fill="#1a56db"/>
              <path d="M108 8 L122 13 L108 18 Z" fill="#3b82f6"/>
            </svg>
            <div style="font-family:var(--font-head);font-size:17px;font-weight:700;margin-bottom:6px">üö¢ Sea Freight</div>
            <div style="font-family:var(--font-head);font-size:48px;font-weight:800;background:linear-gradient(135deg,var(--sky),#38bdf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1">US$35<span style="font-size:18px;-webkit-text-fill-color:var(--slate)"> / cu ft</span></div>
            <div class="chip" style="margin-top:12px;background:rgba(14,165,233,.08);color:#0369a1;border-color:rgba(14,165,233,.2)">üïí 4‚Äì6 Weeks</div>
            <div class="divider-h"></div>
            <ul style="text-align:left;list-style:none;font-size:14px;color:var(--slate)">
              <li style="padding:5px 0">‚úì Bi-weekly departures</li>
              <li style="padding:5px 0">‚úì Best for heavy / bulky</li>
              <li style="padding:5px 0">‚úì Barrel & crate packing</li>
              <li style="padding:5px 0">‚úì Appliances & furniture</li>
            </ul>
          </div>
        </div>
        <!-- Calculator -->
        <div class="card">
          <div class="section-title" style="margin-bottom:20px">üí∞ Shipping Cost Calculator</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:22px">
            <div class="field"><label>Weight in lbs (Air)</label><input id="calcW" type="number" min="0" step="0.1" placeholder="e.g. 5.5" oninput="calcRate()"/></div>
            <div class="field"><label>Volume in cu ft (Sea)</label><input id="calcV" type="number" min="0" step="0.1" placeholder="e.g. 2.0" oninput="calcRate()"/></div>
          </div>
          <div id="calcOut" style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
            <div style="background:var(--mist);border-radius:var(--r-md);padding:22px;text-align:center;border:1px solid rgba(26,86,219,.1)">
              <div style="font-size:13px;color:var(--slate);margin-bottom:6px">‚úàÔ∏è Air Estimate</div>
              <div id="airCost" style="font-family:var(--font-head);font-size:32px;font-weight:800;color:var(--blue)">‚Äî</div>
              <div style="font-size:11px;color:var(--slate);margin-top:4px">incl. 35% duty + 15% GCT</div>
            </div>
            <div style="background:var(--mist);border-radius:var(--r-md);padding:22px;text-align:center;border:1px solid rgba(14,165,233,.12)">
              <div style="font-size:13px;color:var(--slate);margin-bottom:6px">üö¢ Sea Estimate</div>
              <div id="seaCost" style="font-family:var(--font-head);font-size:32px;font-weight:800;color:var(--sky)">‚Äî</div>
              <div style="font-size:11px;color:var(--slate);margin-top:4px">incl. 35% duty + 15% GCT</div>
            </div>
          </div>
          <p style="color:var(--slate);font-size:12px;margin-top:16px">* Estimate only. Final charges may vary based on actual dimensions, special handling, and customs assessment.</p>
        </div>
      </div>

      <!-- ‚ïê‚ïê INVOICES TAB ‚ïê‚ïê -->
      <div id="tab-invoices" class="hidden">
        <div class="card">
          <div class="section-head">
            <div class="section-title">üßæ My Invoices</div>
            <div class="chip" id="invoiceCount">0 invoices</div>
          </div>
          <div class="table-wrap">
            <table>
              <thead><tr>
                <th>Invoice #</th><th>Package</th><th>Shipping</th><th>Duty</th><th>GCT</th><th>Total</th><th>Status</th><th>Action</th>
              </tr></thead>
              <tbody id="invoiceTable"><tr><td colspan="8" class="text-center" style="padding:32px;color:var(--slate)">Loading‚Ä¶</td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê ADDRESS TAB ‚ïê‚ïê -->
      <div id="tab-address" class="hidden">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
          <div class="card">
            <div class="section-title" style="margin-bottom:20px">üè† Your US Addresses</div>
            <div style="margin-bottom:22px">
              <div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--slate);margin-bottom:10px">üåÖ Miami Warehouse</div>
              <div style="background:var(--mist);border:1.5px solid rgba(26,86,219,.14);border-radius:var(--r-md);padding:18px;font-size:15px;font-weight:500;line-height:2;color:var(--navy)" id="miamiAddr">Loading‚Ä¶</div>
              <button class="btn btn-outline btn-sm" style="margin-top:10px" onclick="copyAddr('miami')">üìã Copy Miami Address</button>
            </div>
            <div>
              <div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--slate);margin-bottom:10px">üóΩ New York Warehouse</div>
              <div style="background:var(--mist);border:1.5px solid rgba(26,86,219,.14);border-radius:var(--r-md);padding:18px;font-size:15px;font-weight:500;line-height:2;color:var(--navy)" id="nycAddr">Loading‚Ä¶</div>
              <button class="btn btn-outline btn-sm" style="margin-top:10px" onclick="copyAddr('nyc')">üìã Copy NYC Address</button>
            </div>
          </div>
          <div>
            <div class="card" style="margin-bottom:18px">
              <div class="section-title" style="margin-bottom:14px;font-size:16px">üìù How to Use</div>
              <ol style="list-style:none;counter-reset:steps;font-size:14px;color:var(--slate);line-height:1.8">
                <li style="counter-increment:steps;display:flex;gap:12px;padding:8px 0;border-bottom:1px solid rgba(26,86,219,.06)">
                  <div style="width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;font-weight:700;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0">1</div>
                  <span>Copy your Miami or New York address above</span>
                </li>
                <li style="counter-increment:steps;display:flex;gap:12px;padding:8px 0;border-bottom:1px solid rgba(26,86,219,.06)">
                  <div style="width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;font-weight:700;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0">2</div>
                  <span>Paste it as your shipping address when checking out at any US store</span>
                </li>
                <li style="counter-increment:steps;display:flex;gap:12px;padding:8px 0;border-bottom:1px solid rgba(26,86,219,.06)">
                  <div style="width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;font-weight:700;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0">3</div>
                  <span>Submit a Pre-Alert so we know to expect your package</span>
                </li>
                <li style="counter-increment:steps;display:flex;gap:12px;padding:8px 0">
                  <div style="width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;font-weight:700;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0">4</div>
                  <span>We'll notify you when it arrives ‚Äî then ship it to Jamaica!</span>
                </li>
              </ol>
            </div>
            <div class="card" style="background:linear-gradient(135deg,rgba(26,86,219,.05),rgba(14,165,233,.05));border-color:rgba(26,86,219,.14)">
              <div class="section-title" style="margin-bottom:12px;font-size:15px">‚ö†Ô∏è Important Notes</div>
              <ul style="list-style:none;font-size:13px;color:var(--slate);line-height:2">
                <li>‚Ä¢ Always include your name and member ID</li>
                <li>‚Ä¢ Do NOT use a PO Box ‚Äî use the full suite address</li>
                <li>‚Ä¢ Packages held max 30 days at no charge</li>
                <li>‚Ä¢ Check prohibited items list before ordering</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PROFILE TAB ‚ïê‚ïê -->
      <div id="tab-profile" class="hidden">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
          <div class="card">
            <div class="section-title" style="margin-bottom:22px">üë§ Profile Information</div>
            <div class="field-row">
              <div class="field"><label>First Name</label><input id="profFirst" placeholder="Paul"/></div>
              <div class="field"><label>Last Name</label><input id="profLast" placeholder="Medley"/></div>
            </div>
            <div class="field"><label>Email (read-only)</label><input id="profEmail" readonly style="background:#f1f5f9;cursor:not-allowed"/></div>
            <div class="field"><label>Phone Number</label><input id="profPhone" placeholder="876-xxx-xxxx"/></div>
            <div class="field"><label>Preferred Branch</label>
              <select id="profBranch">
                <option>Kingston</option><option>Cross Roads</option><option>Portmore</option>
                <option>Montego Bay</option><option>Spanish Town</option><option>Mandeville</option>
                <option>Ocho Rios</option><option>May Pen</option>
              </select>
            </div>
            <button class="btn btn-primary btn-full" onclick="saveProfile()">üíæ Save Profile</button>
          </div>
          <div>
            <div class="card" style="margin-bottom:18px">
              <div class="section-title" style="margin-bottom:18px;font-size:16px">üîí Change Password</div>
              <div class="field"><label>New Password</label><input type="password" id="newPass" placeholder="Min 8 characters"/></div>
              <div class="field"><label>Confirm Password</label><input type="password" id="confPass" placeholder="Repeat password"/></div>
              <button class="btn btn-outline btn-full" onclick="changePassword()">Update Password</button>
            </div>
            <div class="card" style="background:var(--mist)">
              <div class="section-title" style="margin-bottom:12px;font-size:15px">‚ÑπÔ∏è Account Info</div>
              <div style="font-size:14px;color:var(--slate);line-height:2.2">
                <div>Member ID: <strong id="infoId" style="color:var(--blue)">‚Äî</strong></div>
                <div>Branch: <strong id="infoBranch" style="color:var(--navy)">‚Äî</strong></div>
                <div>Member Since: <strong id="infoSince" style="color:var(--navy)">‚Äî</strong></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /page-content -->
  </div><!-- /main -->
</div><!-- /app -->

<!-- ‚ïê‚ïê‚ïê INVOICE MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="invoice-modal">
  <div class="modal modal-lg">
    <div class="modal-head">
      <button class="modal-close" onclick="closeModal('invoice-modal')">√ó</button>
      <h3>Invoice Details</h3>
      <p>IslandShip Logistics Ltd.</p>
    </div>
    <div class="modal-body">
      <div class="invoice-wrap" id="invoiceContent"><!-- filled by JS --></div>
      <div style="display:flex;gap:10px;margin-top:18px;justify-content:flex-end">
        <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è Print</button>
        <button class="btn btn-success" id="invoicePayBtn" onclick="openPayment()">üí≥ Pay Now</button>
        <button class="btn btn-ghost" onclick="closeModal('invoice-modal')">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PAYMENT MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="pay-modal">
  <div class="modal">
    <div class="modal-head">
      <button class="modal-close" onclick="closeModal('pay-modal')">√ó</button>
      <h3>Complete Payment</h3>
      <p id="payModalSub">Select a payment method</p>
    </div>
    <div class="modal-body" id="payModalBody">
      <div style="background:var(--mist);border-radius:var(--r-md);padding:18px;margin-bottom:22px;text-align:center">
        <div style="font-size:12px;color:var(--slate);margin-bottom:4px">Amount Due</div>
        <div style="font-family:var(--font-head);font-size:38px;font-weight:800;background:linear-gradient(135deg,var(--blue),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text" id="payAmount">US$0.00</div>
        <div style="font-size:12px;color:var(--slate);margin-top:4px" id="payInvRef">‚Äî</div>
      </div>
      <div class="pay-grid">
        <div class="pay-opt" onclick="selectPay('paypal')">
          <span class="pay-opt-icon">üÖøÔ∏è</span>
          <div><div class="pay-opt-name">PayPal</div><div class="pay-opt-sub">Pay with PayPal</div></div>
        </div>
        <div class="pay-opt" onclick="selectPay('card')">
          <span class="pay-opt-icon">üí≥</span>
          <div><div class="pay-opt-name">Credit/Debit</div><div class="pay-opt-sub">Visa, Mastercard</div></div>
        </div>
        <div class="pay-opt" onclick="selectPay('lynk')">
          <span class="pay-opt-icon">üì±</span>
          <div><div class="pay-opt-name">Lynk</div><div class="pay-opt-sub">Jamaican mobile pay</div></div>
        </div>
        <div class="pay-opt" onclick="selectPay('bank')">
          <span class="pay-opt-icon">üè¶</span>
          <div><div class="pay-opt-name">Bank Transfer</div><div class="pay-opt-sub">Direct bank payment</div></div>
        </div>
      </div>
      <div id="cardFields" class="hidden">
        <div class="field"><label>Card Number</label><input placeholder="1234 5678 9012 3456" maxlength="19"/></div>
        <div class="field-row">
          <div class="field"><label>Expiry</label><input placeholder="MM/YY"/></div>
          <div class="field"><label>CVV</label><input placeholder="123"/></div>
        </div>
        <div class="field"><label>Cardholder Name</label><input placeholder="Paul Medley"/></div>
      </div>
      <button class="btn btn-primary btn-full btn-lg btn-disabled" id="payNowBtn" onclick="processPayment()">üîí Pay Securely</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PRE-ALERT QUICK MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="prealert-modal">
  <div class="modal">
    <div class="modal-head">
      <button class="modal-close" onclick="closeModal('prealert-modal')">√ó</button>
      <h3>Quick Pre-Alert</h3>
      <p>Notify us about an incoming package</p>
    </div>
    <div class="modal-body">
      <div class="field"><label>Store / Merchant *</label><input id="qpaStore" placeholder="Amazon, Nike‚Ä¶"/></div>
      <div class="field"><label>Item Description *</label><input id="qpaDesc" placeholder="Nike Shoes Size 10"/></div>
      <div class="field"><label>US Tracking Number</label><input id="qpaTracking" placeholder="1Z999AA10123456784"/></div>
      <div class="field-row">
        <div class="field"><label>Est. Weight (lbs)</label><input id="qpaWeight" type="number" placeholder="2.5"/></div>
        <div class="field"><label>Mode</label><select id="qpaMode"><option value="air">‚úàÔ∏è Air</option><option value="sea">üö¢ Sea</option></select></div>
      </div>
      <button class="btn btn-primary btn-full" onclick="quickPreAlert()">Submit Pre-Alert</button>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SUPABASE CONFIG ‚Äî Replace with your values
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SUPABASE_URL = 'https://YOUR_PROJECT.supabase.co';
const SUPABASE_KEY = 'YOUR_ANON_KEY';

let sb = null;
let currentUser = null;
let userProfile = null;
let allPackages = [];
let allPrealerts = [];
let activeInvoicePkg = null;
let selectedPayMethod = null;

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
if (SUPABASE_URL !== 'https://YOUR_PROJECT.supabase.co') {
  sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  sb.auth.onAuthStateChange(async (event, session) => {
    currentUser = session?.user ?? null;
    if (currentUser) {
      await loadProfile();
      await loadPackages();
      await loadPrealerts();
    } else {
      showToast('info','Please sign in to access your dashboard.');
      setTimeout(()=> window.location.href = 'index.html', 1500);
    }
  });
} else {
  // ‚îÄ‚îÄ DEMO MODE ‚îÄ‚îÄ
  console.log('[IslandShip] Demo mode');
  loadDemoData();
}

/* ‚ïê‚ïê‚ïê DEMO DATA ‚ïê‚ïê‚ïê */
function loadDemoData() {
  userProfile = {
    id:'demo-user', member_id:'BAL-10349',
    full_name:'Paul Medley', first_name:'Paul', last_name:'Medley',
    email:'paul@email.com', phone:'876-371-9167',
    branch:'Cross Roads', created_at:'2026-01-31'
  };
  allPackages = [
    {id:'PKG-2026-0001',desc:'Nike Air Max 270 √ó 2',weight:3.2,mode:'air',status:'transit',arrived:'2026-02-10',eta:'2026-02-20',cost_usd:22.40,paid:true,invoice_id:'INV-2026-001',store:'Nike.com'},
    {id:'PKG-2026-0002',desc:'iPhone 15 Pro Case + Screen Protector',weight:0.8,mode:'air',status:'warehouse',arrived:'2026-02-14',eta:'2026-02-21',cost_usd:5.60,paid:false,invoice_id:'INV-2026-002',store:'Amazon'},
    {id:'PKG-2026-0003',desc:'CeraVe Skincare Bundle (6 items)',weight:4.1,mode:'sea',status:'delivered',arrived:'2026-01-15',eta:'2026-02-05',cost_usd:143.50,paid:true,invoice_id:'INV-2026-003',store:'Ulta'},
    {id:'PKG-2026-0004',desc:'Vitamins & Supplements Set',weight:6.2,mode:'sea',status:'customs',arrived:'2026-02-12',eta:'2026-02-22',cost_usd:217.00,paid:false,invoice_id:'INV-2026-004',store:'iHerb'},
  ];
  allPrealerts = [
    {id:'PA-001',store:'Amazon',tracking:'1Z999AA123',desc:'Laptop Stand',est_weight:2.5,mode:'air',status:'pending',created_at:'2026-02-15'},
  ];
  renderAll();
}

/* ‚ïê‚ïê‚ïê SUPABASE LOADERS ‚ïê‚ïê‚ïê */
async function loadProfile() {
  const {data} = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
  userProfile = data || { full_name: currentUser.email, email: currentUser.email, member_id: 'BAL-00000' };
  renderAll();
}
async function loadPackages() {
  const {data} = await sb.from('packages').select('*').eq('user_id', currentUser.id).order('arrived', {ascending:false});
  allPackages = data || [];
  renderPackages();
  updateStats();
}
async function loadPrealerts() {
  const {data} = await sb.from('prealerts').select('*').eq('user_id', currentUser.id).order('created_at', {ascending:false});
  allPrealerts = data || [];
  renderPrealerts();
}

/* ‚ïê‚ïê‚ïê RENDER ALL ‚ïê‚ïê‚ïê */
function renderAll() {
  updateSidebarUser();
  updateAddressCard();
  renderPackages();
  updateStats();
  renderPrealerts();
  renderInvoices();
  renderAddresses();
  renderProfile();
}

/* ‚ïê‚ïê‚ïê SIDEBAR USER ‚ïê‚ïê‚ïê */
function updateSidebarUser() {
  if (!userProfile) return;
  const n = userProfile.full_name || userProfile.email || 'User';
  document.getElementById('userName').textContent = n;
  document.getElementById('userEmail').textContent = userProfile.email || '';
  document.getElementById('userAvatar').textContent = n[0]?.toUpperCase() || 'U';
  document.getElementById('memberId').textContent = userProfile.member_id || '‚Äî';
}

/* ‚ïê‚ïê‚ïê ADDRESS ‚ïê‚ïê‚ïê */
function updateAddressCard() {
  if (!userProfile) return;
  const n = userProfile.full_name;
  const id = userProfile.member_id;
  document.getElementById('addressText').innerHTML = `${n} (${id})<br>2750 NW 87th Ave, Suite 100<br>Miami, FL 33172, USA`;
}
function renderAddresses() {
  if (!userProfile) return;
  const n = userProfile.full_name;
  const id = userProfile.member_id;
  document.getElementById('miamiAddr').innerHTML = `${n} (${id})<br>2750 NW 87th Ave, Suite 100<br>Miami, FL 33172<br>United States`;
  document.getElementById('nycAddr').innerHTML = `${n} (${id})<br>630 Flushing Ave, Suite 200<br>Brooklyn, NY 11206<br>United States`;
}
function copyAddress() {
  const txt = document.getElementById('addressText').innerText;
  navigator.clipboard?.writeText(txt);
  showToast('success','üìã Address copied to clipboard!');
}
function copyAddr(type) {
  const id = type === 'miami' ? 'miamiAddr' : 'nycAddr';
  const txt = document.getElementById(id).innerText;
  navigator.clipboard?.writeText(txt);
  showToast('success','üìã Address copied!');
}

/* ‚ïê‚ïê‚ïê STATS ‚ïê‚ïê‚ïê */
function updateStats() {
  const pkgs = allPackages;
  const total = pkgs.length;
  const wh = pkgs.filter(p=>p.status==='warehouse').length;
  const tr = pkgs.filter(p=>p.status==='transit').length;
  const dl = pkgs.filter(p=>p.status==='delivered').length;
  const up = pkgs.filter(p=>!p.paid).length;
  const spent = pkgs.filter(p=>p.paid).reduce((s,p)=>s+(p.cost_usd||0),0);

  document.getElementById('statTotal').textContent = total;
  document.getElementById('statWarehouse').textContent = wh;
  document.getElementById('statTransit').textContent = tr;
  document.getElementById('statDelivered').textContent = dl;
  document.getElementById('statUnpaid').textContent = up;
  document.getElementById('statSpent').textContent = '$'+spent.toFixed(0);

  const badge = document.getElementById('pkgBadge');
  if(up > 0){
    badge.textContent = up; badge.style.display='flex';
    const al = document.getElementById('unpaidAlert');
    al.classList.remove('hidden');
    document.getElementById('unpaidAlertText').textContent = `You have ${up} unpaid invoice${up>1?'s':''} ‚Äî pay to avoid shipment delays.`;
  } else {
    badge.style.display='none';
    document.getElementById('unpaidAlert').classList.add('hidden');
  }
}

/* ‚ïê‚ïê‚ïê STATUS HELPERS ‚ïê‚ïê‚ïê */
const STATUS_MAP = {
  warehouse:{label:'In Warehouse',icon:'üì¶',cls:'badge-warehouse'},
  transit:  {label:'In Transit',  icon:'‚úàÔ∏è',cls:'badge-transit'},
  customs:  {label:'At Customs',  icon:'üõÉ',cls:'badge-customs'},
  ready:    {label:'Ready Pickup',icon:'‚úÖ',cls:'badge-ready'},
  delivered:{label:'Delivered',   icon:'üè†',cls:'badge-delivered'},
};
function statusBadge(s) {
  const m = STATUS_MAP[s]||{label:s,icon:'?',cls:'badge-warehouse'};
  return `<span class="badge ${m.cls}">${m.icon} ${m.label}</span>`;
}
function payBadge(paid) {
  return paid
    ? `<span class="badge badge-paid">‚úì Paid</span>`
    : `<span class="badge badge-unpaid">‚úó Unpaid</span>`;
}

/* ‚ïê‚ïê‚ïê PACKAGES TABLE ‚ïê‚ïê‚ïê */
function renderPackages() {
  const filter = document.getElementById('pkgFilter')?.value || 'all';
  const pkgs = allPackages.filter(p => filter === 'all' || p.status === filter);

  // Recent (overview - show 5)
  const rt = document.getElementById('recentPkgTable');
  if(rt) rt.innerHTML = pkgs.slice(0,5).map(p=>`
    <tr>
      <td class="td-id">${p.id}</td>
      <td style="max-width:160px;color:var(--mid)">${p.desc}</td>
      <td>${p.mode==='air'?'‚úàÔ∏è Air':'üö¢ Sea'}</td>
      <td>${statusBadge(p.status)}</td>
      <td><span style="font-weight:600;color:${p.paid?'var(--success)':'var(--danger)'}">US$${(p.cost_usd||0).toFixed(2)}</span></td>
      <td>
        <button class="btn btn-ghost btn-sm" onclick="viewInvoice('${p.id}')">üßæ Invoice</button>
        ${!p.paid?`<button class="btn btn-primary btn-sm" style="margin-left:5px" onclick="openPayForPkg('${p.id}')">Pay</button>`:''}
      </td>
    </tr>`).join('') || `<tr><td colspan="6"><div class="empty" style="padding:24px 0"><div class="empty-icon" style="font-size:32px">üì≠</div><p>No packages yet</p></div></td></tr>`;

  // All packages table
  const at = document.getElementById('allPkgTable');
  if(at) at.innerHTML = pkgs.map(p=>`
    <tr>
      <td class="td-id">${p.id}</td>
      <td style="max-width:150px;color:var(--mid)">${p.desc}</td>
      <td>${p.weight} lbs</td>
      <td>${p.mode==='air'?'‚úàÔ∏è Air':'üö¢ Sea'}</td>
      <td style="color:var(--slate);font-size:13px">${p.store||'‚Äî'}</td>
      <td style="color:var(--slate);font-size:13px">${p.arrived||'‚Äî'}</td>
      <td style="color:${p.status==='delivered'?'var(--success)':'var(--blue)'};font-size:13px">${p.eta||'‚Äî'}</td>
      <td>${statusBadge(p.status)}</td>
      <td><span class="td-link" onclick="viewInvoice('${p.id}')">${p.invoice_id||'‚Äî'}</span></td>
      <td>
        ${!p.paid
          ? `<button class="btn btn-primary btn-sm" onclick="openPayForPkg('${p.id}')">Pay Now</button>`
          : `<span class="badge badge-paid">‚úì Paid</span>`}
      </td>
    </tr>`).join('') || `<tr><td colspan="10"><div class="empty"><div class="empty-icon">üì≠</div><p>No packages found</p></div></td></tr>`;
}

/* ‚ïê‚ïê‚ïê TRACK PACKAGE ‚ïê‚ïê‚ïê */
const STEP_ICONS  = ['üì¶','‚öñÔ∏è','‚úàÔ∏è','üõÉ','üì´'];
const STEP_LABELS = ['US Warehouse','Weighed &<br>Logged','In Transit','Customs','Ready / Delivered'];
const STATUS_STEP = {warehouse:0, transit:2, customs:3, ready:4, delivered:4};

function doTrack() {
  const id = document.getElementById('trackId').value.trim().toUpperCase();
  const el = document.getElementById('trackResult');
  let pkg = allPackages.find(p=>p.id.toUpperCase()===id||p.invoice_id?.toUpperCase()===id);

  if(!pkg){
    el.innerHTML = `<div class="empty"><div class="empty-icon">üîç</div><h4>Package Not Found</h4><p>Try one of your package IDs from the Packages tab.</p></div>`;
    return;
  }

  const step = STATUS_STEP[pkg.status] ?? 0;
  const pct = Math.round((step+1)/5*100);
  let nodes = '';
  for(let i=0;i<5;i++){
    const cls = i<step?'done':i===step?'current':'pending';
    nodes += `<div class="step-node"><div class="step-dot ${cls}">${cls==='done'?'‚úì':STEP_ICONS[i]}</div><div class="step-lbl ${cls}">${STEP_LABELS[i]}</div></div>`;
  }

  el.innerHTML = `
    <div style="margin-bottom:18px">
      <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:18px">
        <div>
          <div style="font-family:var(--font-head);font-size:17px;font-weight:700">${pkg.id}</div>
          <div style="color:var(--slate);font-size:13px;margin-top:3px">${pkg.desc} ¬∑ ${pkg.weight}lbs ¬∑ ${pkg.mode==='air'?'‚úàÔ∏è Air':'üö¢ Sea'}</div>
        </div>
        ${statusBadge(pkg.status)}
      </div>
    </div>
    <div class="steps-track" style="--pct:${pct}%">${nodes}</div>
    <div style="background:var(--mist);border-radius:var(--r-md);padding:14px 18px;margin-top:14px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;font-size:14px">
      <span>Store: <strong>${pkg.store||'‚Äî'}</strong> ¬∑ Arrived: <strong>${pkg.arrived||'‚Äî'}</strong></span>
      <span style="color:var(--sky);font-weight:600">ETA: ${pkg.eta||'‚Äî'}</span>
    </div>`;
}

/* ‚ïê‚ïê‚ïê PRE-ALERTS ‚ïê‚ïê‚ïê */
async function submitPreAlert() {
  const store    = document.getElementById('paStore').value.trim();
  const tracking = document.getElementById('paTracking').value.trim();
  const desc     = document.getElementById('paDesc').value.trim();
  const weight   = document.getElementById('paWeight').value;
  const mode     = document.getElementById('paMode').value;
  const notes    = document.getElementById('paNotes').value.trim();
  if(!store||!desc){ showToast('error','Store and description are required.'); return; }

  const entry = {store,tracking_num:tracking,desc,est_weight:parseFloat(weight)||0,mode,notes,status:'pending',created_at:new Date().toISOString()};

  if(sb && currentUser){
    const {error} = await sb.from('prealerts').insert({...entry, user_id:currentUser.id});
    if(error){ showToast('error',error.message); return; }
    await loadPrealerts();
  } else {
    allPrealerts.unshift({id:'PA-'+Date.now(),...entry});
    renderPrealerts();
  }

  document.getElementById('paSuccess').classList.remove('hidden');
  document.getElementById('paStore').value='';
  document.getElementById('paTracking').value='';
  document.getElementById('paDesc').value='';
  document.getElementById('paWeight').value='';
  document.getElementById('paNotes').value='';
  showToast('success','üì¨ Pre-alert submitted!');
}

async function quickPreAlert() {
  const store = document.getElementById('qpaStore').value.trim();
  const desc  = document.getElementById('qpaDesc').value.trim();
  if(!store||!desc){ showToast('error','Store and description required.'); return; }
  const entry = {store, tracking_num:document.getElementById('qpaTracking').value.trim(), desc, est_weight:parseFloat(document.getElementById('qpaWeight').value)||0, mode:document.getElementById('qpaMode').value, status:'pending', created_at:new Date().toISOString()};
  if(sb && currentUser){
    await sb.from('prealerts').insert({...entry, user_id:currentUser.id});
    await loadPrealerts();
  } else {
    allPrealerts.unshift({id:'PA-'+Date.now(),...entry});
    renderPrealerts();
  }
  closeModal('prealert-modal');
  showToast('success','üì¨ Pre-alert submitted!');
}

function renderPrealerts() {
  const el = document.getElementById('myPrealerts');
  if(!el) return;
  if(!allPrealerts.length){
    el.innerHTML = `<div class="empty" style="padding:18px 0"><div class="empty-icon" style="font-size:32px">üì¨</div><p style="font-size:13px">No pre-alerts yet</p></div>`;
    return;
  }
  el.innerHTML = allPrealerts.map(a=>`
    <div style="border-bottom:1px solid rgba(26,86,219,.07);padding:12px 0;display:flex;justify-content:space-between;align-items:flex-start;gap:10px">
      <div>
        <div style="font-weight:600;font-size:14px;color:var(--navy);margin-bottom:2px">${a.desc}</div>
        <div style="font-size:12px;color:var(--slate)">${a.store} ¬∑ ${a.mode==='air'?'‚úàÔ∏è':'üö¢'} ¬∑ ${(a.created_at||'').slice(0,10)}</div>
      </div>
      <span class="badge ${a.status==='pending'?'badge-warehouse':'badge-ready'}">${a.status==='pending'?'‚è≥ Pending':'‚úÖ Received'}</span>
    </div>`).join('');
}

/* ‚ïê‚ïê‚ïê INVOICES ‚ïê‚ïê‚ïê */
function renderInvoices() {
  const el = document.getElementById('invoiceTable');
  const count = document.getElementById('invoiceCount');
  if(!el) return;
  if(!allPackages.length){
    el.innerHTML = `<tr><td colspan="8"><div class="empty"><div class="empty-icon">üßæ</div><p>No invoices yet</p></div></td></tr>`;
    return;
  }
  count.textContent = `${allPackages.length} invoice${allPackages.length!==1?'s':''}`;
  el.innerHTML = allPackages.map(p=>{
    const ship=p.cost_usd||0, duty=ship*.35, gct=(ship+duty)*.15, tot=ship+duty+gct;
    return `<tr>
      <td class="td-id">${p.invoice_id||'‚Äî'}</td>
      <td style="max-width:150px;font-size:13px;color:var(--mid)">${p.desc}</td>
      <td>US$${ship.toFixed(2)}</td>
      <td>US$${duty.toFixed(2)}</td>
      <td>US$${gct.toFixed(2)}</td>
      <td style="font-weight:700;color:var(--navy)">US$${tot.toFixed(2)}</td>
      <td>${payBadge(p.paid)}</td>
      <td>
        <button class="btn btn-ghost btn-sm" onclick="viewInvoice('${p.id}')">View</button>
        ${!p.paid?`<button class="btn btn-primary btn-sm" style="margin-left:5px" onclick="openPayForPkg('${p.id}')">Pay</button>`:''}
      </td>
    </tr>`;
  }).join('');
}

/* ‚ïê‚ïê‚ïê VIEW INVOICE ‚ïê‚ïê‚ïê */
function viewInvoice(pkgId) {
  const pkg = allPackages.find(p=>p.id===pkgId);
  if(!pkg) return;
  activeInvoicePkg = pkg;
  const ship=pkg.cost_usd||0, duty=ship*.35, gct=(ship+duty)*.15, tot=ship+duty+gct;
  const name = userProfile?.full_name || 'Customer';
  const memberId = userProfile?.member_id || '‚Äî';

  document.getElementById('invoiceContent').innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;padding-bottom:20px;border-bottom:2px solid #f1f5f9;flex-wrap:wrap;gap:16px">
      <div>
        <div class="invoice-logo">
          <div class="icon">üáØüá≤</div>
          <div class="name">IslandShip</div>
        </div>
        <div style="color:#64748b;font-size:13px;line-height:1.9;margin-top:6px">
          2750 NW 87th Ave, Suite 100<br>Miami, FL 33172<br>hello@islandship.jm
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-family:var(--font-head);font-size:32px;font-weight:800;background:linear-gradient(135deg,var(--blue),var(--sky));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">INVOICE</div>
        <div style="color:#94a3b8;font-size:14px;margin-top:4px">${pkg.invoice_id||'‚Äî'}</div>
        <div style="margin-top:10px">${payBadge(pkg.paid)}</div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:22px">
      <div>
        <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:#aaa;margin-bottom:6px">Bill To</div>
        <div style="font-weight:700;font-size:15px">${name}</div>
        <div style="color:#64748b;font-size:13px;line-height:1.9">${userProfile?.email||''}<br>Member ID: ${memberId}</div>
      </div>
      <div>
        <div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:#aaa;margin-bottom:6px">Shipment Info</div>
        <div style="color:#475569;font-size:13px;line-height:1.9">
          Mode: ${pkg.mode==='air'?'‚úàÔ∏è Air Freight':'üö¢ Sea Freight'}<br>
          Weight: ${pkg.weight} lbs<br>
          Store: ${pkg.store||'‚Äî'}<br>
          Arrived US: ${pkg.arrived||'‚Äî'}
        </div>
      </div>
    </div>
    <table class="inv-table" style="margin-bottom:6px">
      <thead><tr><th>Description</th><th>Weight</th><th>Rate</th><th style="text-align:right">Amount</th></tr></thead>
      <tbody>
        <tr><td>${pkg.desc}</td><td>${pkg.weight} lbs</td><td>US$${pkg.mode==='air'?7:35}/${pkg.mode==='air'?'lb':'cu ft'}</td><td style="text-align:right;font-weight:600">US$${ship.toFixed(2)}</td></tr>
        <tr><td colspan="3" style="color:#64748b">Import Duty (35%)</td><td style="text-align:right">US$${duty.toFixed(2)}</td></tr>
        <tr><td colspan="3" style="color:#64748b">GCT (15%)</td><td style="text-align:right">US$${gct.toFixed(2)}</td></tr>
      </tbody>
      <tfoot><tr class="inv-total-row"><td colspan="3">TOTAL DUE</td><td style="text-align:right;font-size:17px">US$${tot.toFixed(2)}</td></tr></tfoot>
    </table>
    <div style="text-align:center;color:#aaa;font-size:12px;margin-top:14px">Thank you for choosing IslandShip ¬∑ hello@islandship.jm</div>
  `;

  const payBtn = document.getElementById('invoicePayBtn');
  payBtn.style.display = pkg.paid ? 'none' : 'inline-flex';

  openModal('invoice-modal');
}

/* ‚ïê‚ïê‚ïê PAYMENT ‚ïê‚ïê‚ïê */
function openPayment() {
  closeModal('invoice-modal');
  openPayForPkg(activeInvoicePkg?.id);
}
function openPayForPkg(pkgId) {
  const pkg = allPackages.find(p=>p.id===pkgId);
  if(!pkg) return;
  activeInvoicePkg = pkg;
  const ship=pkg.cost_usd||0, duty=ship*.35, gct=(ship+duty)*.15, tot=ship+duty+gct;
  document.getElementById('payAmount').textContent = `US$${tot.toFixed(2)}`;
  document.getElementById('payInvRef').textContent = `${pkg.invoice_id} ¬∑ ${pkg.desc}`;
  selectedPayMethod = null;
  document.querySelectorAll('.pay-opt').forEach(o=>o.classList.remove('selected'));
  document.getElementById('cardFields').classList.add('hidden');
  document.getElementById('payNowBtn').classList.add('btn-disabled');
  document.getElementById('payModalSub').textContent = 'Select a payment method';
  openModal('pay-modal');
}

function selectPay(method) {
  selectedPayMethod = method;
  document.querySelectorAll('.pay-opt').forEach(o=>o.classList.remove('selected'));
  event.currentTarget.classList.add('selected');
  document.getElementById('cardFields').classList.toggle('hidden', method !== 'card');
  document.getElementById('payNowBtn').classList.remove('btn-disabled');
  document.getElementById('payModalSub').textContent = 'Confirm your payment';
}

async function processPayment() {
  if(!selectedPayMethod || !activeInvoicePkg) return;
  const btn = document.getElementById('payNowBtn');
  btn.innerHTML = '<div class="spinner"></div> Processing‚Ä¶';
  btn.classList.add('btn-disabled');

  await new Promise(r=>setTimeout(r, 2200));

  if(sb && currentUser){
    await sb.from('packages').update({paid:true}).eq('id', activeInvoicePkg.id);
    const pkg = activeInvoicePkg;
    const tot = ((pkg.cost_usd||0)*1.35*1.15).toFixed(2);
    await sb.from('transactions').insert({
      user_id:currentUser.id, package_id:pkg.id, invoice_id:pkg.invoice_id,
      amount:parseFloat(tot), method:selectedPayMethod, status:'completed',
      reference:'TXN-'+Date.now(), created_at:new Date().toISOString()
    });
    await loadPackages();
  } else {
    const idx = allPackages.findIndex(p=>p.id===activeInvoicePkg.id);
    if(idx>-1) allPackages[idx].paid=true;
    renderPackages(); updateStats(); renderInvoices();
  }

  closeModal('pay-modal');
  showToast('success','‚úÖ Payment successful! Invoice marked as paid.');
  btn.innerHTML = 'üîí Pay Securely';
  btn.classList.remove('btn-disabled');
}

/* ‚ïê‚ïê‚ïê PROFILE ‚ïê‚ïê‚ïê */
function renderProfile() {
  if(!userProfile) return;
  document.getElementById('profFirst').value = userProfile.first_name || '';
  document.getElementById('profLast').value  = userProfile.last_name  || '';
  document.getElementById('profEmail').value = userProfile.email      || '';
  document.getElementById('profPhone').value = userProfile.phone      || '';
  const br = document.getElementById('profBranch');
  if(br && userProfile.branch) {
    for(let o of br.options) if(o.value===userProfile.branch) o.selected=true;
  }
  document.getElementById('infoId').textContent    = userProfile.member_id || '‚Äî';
  document.getElementById('infoBranch').textContent = userProfile.branch || '‚Äî';
  document.getElementById('infoSince').textContent  = (userProfile.created_at||'').slice(0,10) || '‚Äî';
}
async function saveProfile() {
  const updates = {
    first_name:document.getElementById('profFirst').value.trim(),
    last_name: document.getElementById('profLast').value.trim(),
    phone:     document.getElementById('profPhone').value.trim(),
    branch:    document.getElementById('profBranch').value,
  };
  updates.full_name = `${updates.first_name} ${updates.last_name}`;

  if(sb && currentUser){
    const {error} = await sb.from('profiles').update(updates).eq('id', currentUser.id);
    if(error){ showToast('error',error.message); return; }
  }
  Object.assign(userProfile, updates);
  updateSidebarUser(); updateAddressCard(); renderAddresses();
  showToast('success','üíæ Profile saved!');
}
async function changePassword() {
  const np = document.getElementById('newPass').value;
  const cp = document.getElementById('confPass').value;
  if(!np||!cp){ showToast('error','Fill in both password fields.'); return; }
  if(np!==cp){ showToast('error','Passwords do not match.'); return; }
  if(np.length<8){ showToast('error','Password must be at least 8 characters.'); return; }
  if(sb){ const {error}=await sb.auth.updateUser({password:np}); if(error){showToast('error',error.message);return;} }
  showToast('success','üîí Password updated!');
  document.getElementById('newPass').value=''; document.getElementById('confPass').value='';
}

/* ‚ïê‚ïê‚ïê RATE CALCULATOR ‚ïê‚ïê‚ïê */
function calcRate() {
  const w = parseFloat(document.getElementById('calcW').value)||0;
  const v = parseFloat(document.getElementById('calcV').value)||0;
  const air = document.getElementById('airCost');
  const sea = document.getElementById('seaCost');
  if(w>0){const b=w*7,d=b*.35,g=(b+d)*.15;air.textContent=`US$${(b+d+g).toFixed(2)}`;}
  else air.textContent='‚Äî';
  if(v>0){const b=v*35,d=b*.35,g=(b+d)*.15;sea.textContent=`US$${(b+d+g).toFixed(2)}`;}
  else sea.textContent='‚Äî';
}

/* ‚ïê‚ïê‚ïê TAB SWITCHING ‚ïê‚ïê‚ïê */
const TAB_TITLES = {
  overview:'Dashboard Overview', packages:'My Packages', track:'Track a Package',
  prealert:'Pre-Alert System', rates:'Rates & Calculator', invoices:'My Invoices',
  address:'My US Address', profile:'Profile & Settings'
};
function switchTab(name) {
  document.querySelectorAll('[id^="tab-"]').forEach(t=>t.classList.add('hidden'));
  document.getElementById('tab-'+name)?.classList.remove('hidden');
  document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(i=>{ if(i.getAttribute('onclick')?.includes(name)) i.classList.add('active'); });
  document.getElementById('topbarTitle').textContent = TAB_TITLES[name]||name;
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
function openModal(id){ document.getElementById(id).classList.add('open'); document.body.style.overflow='hidden'; }
function closeModal(id){ document.getElementById(id).classList.remove('open'); document.body.style.overflow=''; }
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{ if(e.target===o) closeModal(o.id); }));

/* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
function showToast(type, msg) {
  const tc = document.getElementById('toast-container');
  const t  = document.createElement('div');
  t.className = `toast ${type}`;
  const icons = {success:'‚úÖ',error:'‚ùå',info:'‚ÑπÔ∏è',warn:'‚ö†Ô∏è'};
  t.innerHTML = `<span style="font-size:17px">${icons[type]||'‚ÑπÔ∏è'}</span><span>${msg}</span>`;
  tc.appendChild(t);
  setTimeout(()=>{ t.style.animation='toastIn .35s reverse both'; setTimeout(()=>t.remove(),350); }, 4000);
}

/* ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê */
async function doSignOut(){ if(sb) await sb.auth.signOut(); window.location.href='islandship-part1-landing-auth.html'; }
function goHome(){ window.location.href='islandship-part1-landing-auth.html'; }

/* ‚ïê‚ïê‚ïê BUBBLES ‚ïê‚ïê‚ïê */
(()=>{
  const w=document.getElementById('bubbles-bg');
  for(let i=0;i<16;i++){
    const b=document.createElement('div');
    b.className='bubble-bg';
    const s=3+Math.random()*7;
    b.style.cssText=`width:${s}px;height:${s}px;left:${Math.random()*100}%;--d:${8+Math.random()*10}s;--dl:${Math.random()*12}s`;
    w.appendChild(b);
  }
})();
</script>
</body>
</html>
